{"id":"IGfyv1qwlZVhHwAg","meta":{"instanceId":"ebce9e91983c63ac203ea2e8c45ebc31beb278516b1bc706eed0f485179e3f5c","templateCredsSetupCompleted":true},"name":"Get new ranked keywords from Google AIO via email with DataForSEO","tags":[],"nodes":[{"id":"7c6a4206-8b69-477b-a268-c3cc01ef595c","name":"Aggregate","type":"n8n-nodes-base.aggregate","position":[448,64],"parameters":{"options":{},"aggregate":"aggregateAllItemData"},"typeVersion":1},{"id":"5d68d0af-9f00-4ccd-9e39-bd78bc109689","name":"Get ranked keywords","type":"n8n-nodes-dataforseo.dataForSeoLabsApi","position":[656,432],"parameters":{"limit":1000,"offset":"={{ $runIndex * 1000 }}","operation":"get-ranked-keywords","item_types":"={{ [\"ai_overview_reference\"] }}","target_any":"={{ $('Get targets').item.json.Domain }}","language_name":"={{ $('Get targets').item.json.Language }}","location_name":"={{ $('Get targets').item.json.Location }}"},"credentials":{"dataForSeoApi":{"id":"credential-id","name":"DataForSEO account"}},"typeVersion":1},{"id":"3f030536-2965-47e4-bc89-f4415b8af6e0","name":"Get previous keywords","type":"n8n-nodes-base.googleSheets","position":[224,64],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":1681593026,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit#gid=1681593026","cachedResultName":"Keywords"},"documentId":{"__rl":true,"mode":"list","value":"1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit?usp=drivesdk","cachedResultName":"New Ranked Keywords with ai_overview from Google with DataForSEO"}},"credentials":{"googleSheetsOAuth2Api":{"id":"credential-id","name":"Google Sheets account"}},"typeVersion":4.7,"alwaysOutputData":true},{"id":"97efbef3-7ee4-45e0-887f-0e99b23b2c02","name":"Get targets","type":"n8n-nodes-base.googleSheets","position":[944,64],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit#gid=0","cachedResultName":"Targets"},"documentId":{"__rl":true,"mode":"list","value":"1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit?usp=drivesdk","cachedResultName":"New Ranked Keywords with ai_overview from Google with DataForSEO"}},"credentials":{"googleSheetsOAuth2Api":{"id":"credential-id","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"fbe1c1e5-1180-431d-9026-6e9fed5e6f01","name":"Append keyword in sheet","type":"n8n-nodes-base.googleSheets","position":[368,928],"parameters":{"columns":{"value":{"Url":"={{ $json.ranked_serp_element.serp_item.url }}","Date":"={{ new Date().toLocaleDateString('en-CA') }}","Rank":"={{ $json.ranked_serp_element.serp_item.rank_absolute }}","Target":"={{ $('Get targets').item.json.Domain }}","Keyword":"={{ $json.keyword_data.keyword }}","Search Volume":"={{ $json.keyword_data.keyword_info.search_volume }}","SERP Item Types":"={{ $json.keyword_data.serp_info.serp_item_types.join(', ') }}"},"schema":[{"id":"Target","type":"string","display":true,"required":false,"displayName":"Target","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Keyword","type":"string","display":true,"required":false,"displayName":"Keyword","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Date","type":"string","display":true,"required":false,"displayName":"Date","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Rank","type":"string","display":true,"required":false,"displayName":"Rank","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Search Volume","type":"string","display":true,"required":false,"displayName":"Search Volume","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Url","type":"string","display":true,"required":false,"displayName":"Url","defaultMatch":false,"canBeUsedToMatch":true},{"id":"SERP Item Types","type":"string","display":true,"required":false,"displayName":"SERP Item Types","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"operation":"append","sheetName":{"__rl":true,"mode":"list","value":1681593026,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/1uCvVHKk8rWeQ_FKpZkBfrCB26Q6UebwwzsOdU7EmUYU/edit#gid=1681593026","cachedResultName":"Keywords"},"documentId":{"__rl":true,"mode":"list","value":"1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit?usp=drivesdk","cachedResultName":"New Ranked Keywords with ai_overview from Google with DataForSEO"}},"credentials":{"googleSheetsOAuth2Api":{"id":"credential-id","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"2a093561-3fa1-4b70-89ba-ed45f7f163d0","name":"Run every Monday","type":"n8n-nodes-base.scheduleTrigger","position":[0,64],"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[1],"triggerAtHour":9}]}},"typeVersion":1.3},{"id":"0098aaa3-24b4-4620-8ba5-2167bf99dccf","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[176,-64],"parameters":{"color":6,"width":608,"height":288,"content":"## Get previous keywords and clear the sheet\nCreate a Google Sheets connection and select the spreadsheet where keywords should be saved. The sheet must have the same columns as in [this Example](https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit?gid=1681593026#gid=1681593026)."},"typeVersion":1},{"id":"0eee6cf4-74a6-4294-8864-614b0c911ed9","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[816,-64],"parameters":{"color":6,"width":256,"height":288,"content":"## Get targets\nSelect a spreadsheet with your target domains. The spreadsheet must have the same columns as in [this Example](https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit?gid=0#gid=0)."},"typeVersion":1},{"id":"d94a60a8-b450-4ce9-86c1-fe98879c2000","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[192,336],"parameters":{"color":6,"width":1248,"height":352,"content":"## Get ranked keywords from Google AIO with DataForSEO\nCreate a DataForSEO connection and set up additional parameters if needed."},"typeVersion":1},{"id":"a4e3eadb-a652-4a87-8989-e2f85e1681e0","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[112,752],"parameters":{"color":6,"width":1296,"height":336,"content":"## Save current ranked AIO keywords to the spreadsheet and send new keywords via Email\nSelect the same spreadsheet with your keywords as in the first Google Sheets node.\nCreate a Gmail connection and set a receiver. Add additional information to the message if needed."},"typeVersion":1},{"id":"311c6b38-45b7-4e51-8034-90c0b8aeb6e4","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-544,48],"parameters":{"width":432,"height":640,"content":"This workflow uses DataForSEO Labs API to automatically find new keywords your domains started ranking for in Google’s AI Overview feature, then saves those keywords into Google Sheets, and sends you a short email summary.\n\n## How it works\n1. Triggers on a chosen schedule (default: once a week).\n2. Reads your keywords and domains from Google Sheets.\n3. Pulls the latest data from Google AI Overview via DataForSEO API.\n4. Compares the results with the previous snapshot.\n5. Appends newly ranked keywords to a dedicated Google Sheet.\n6. Sends a weekly summary email.\n\n## Setup steps\n1. Select your spreadsheets with keywords and target domains.\n2. Create or select your DataForSEO connection (use your API login and password – see here).\n3. Create a Gmail connection and choose who gets the message with the new ranked keywords in Google AI Overview.\n"},"typeVersion":1},{"id":"9c6c15d7-c004-4e4a-ab00-bca5fe69b678","name":"Aggregate1","type":"n8n-nodes-base.aggregate","position":[592,928],"parameters":{"options":{},"aggregate":"aggregateAllItemData"},"typeVersion":1},{"id":"f6a6d32f-eb63-4e2f-8008-b17765afc8cc","name":"Clear sheet","type":"n8n-nodes-base.googleSheets","position":[672,64],"parameters":{"operation":"clear","sheetName":{"__rl":true,"mode":"list","value":1681593026,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit#gid=1681593026","cachedResultName":"Keywords"},"documentId":{"__rl":true,"mode":"list","value":"1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1w8bTZ0hfQ0A0e-GZ3s5oDR8-lWqpepU-FJN_Uv4fWwE/edit?usp=drivesdk","cachedResultName":"New Ranked Keywords with ai_overview from Google with DataForSEO"},"keepFirstRow":true},"credentials":{"googleSheetsOAuth2Api":{"id":"credential-id","name":"Google Sheets account"}},"typeVersion":4.7},{"id":"10fa697b-07da-4270-a0d0-8bed0f905612","name":"Send a message","type":"n8n-nodes-base.gmail","position":[1248,928],"webhookId":"9c2daef9-2479-4b7d-a011-49d515de9b35","parameters":{"sendTo":"user@example.com","message":"=<html> <body> <p>New ranked keywords in ai_overview_reference for target {{ $('Get targets').item.json.Domain }}: {{ $json.diff.join(', ') }}</p> </body> </html>","options":{},"subject":"New Ranked Keywords for AIO"},"credentials":{"gmailOAuth2":{"id":"credential-id","name":"Gmail account"}},"typeVersion":2.2},{"id":"3254d177-f942-458e-90dc-c6c4387c9c61","name":"Initialize \"items\" field","type":"n8n-nodes-base.set","position":[208,512],"parameters":{"options":{},"assignments":{"assignments":[{"id":"0126c659-03a5-4fc8-bd76-62d2ecea1195","name":"items","type":"array","value":"={{ [] }}"}]}},"typeVersion":3.4},{"id":"8fbb6c9a-906c-4bce-a6e3-c35a028b1a2c","name":"Set \"items\" field","type":"n8n-nodes-base.set","position":[432,512],"parameters":{"options":{},"assignments":{"assignments":[{"id":"4b3c95a2-4e38-4e37-8e2f-a7e4544808d6","name":"items","type":"array","value":"={{ $json.items }}"}]}},"typeVersion":3.4},{"id":"43361e8b-ebff-4fd5-85ef-56d6b249b14c","name":"Merge \"items\" with DFS response","type":"n8n-nodes-base.set","position":[864,432],"parameters":{"options":{},"assignments":{"assignments":[{"id":"ddd82419-e43e-44d8-919c-2d6602704da5","name":"items","type":"array","value":"={{ [ ...$('Set \"items\" field').item.json.items, ...$json.tasks[0].result[0].items] }}"}]}},"typeVersion":3.4},{"id":"017bb51a-20f6-4b61-9347-d265fb17873a","name":"Has more pages?","type":"n8n-nodes-base.if","position":[1040,512],"parameters":{"options":{},"conditions":{"options":{"version":3,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"cd5943f7-df0b-4329-8436-9a1af3ec7caf","operator":{"type":"number","operation":"lt"},"leftValue":"={{ $runIndex }}","rightValue":"={{ $('Get ranked keywords').item.json.tasks[0].result[0].total_count / 1000 - 1}}"}]}},"typeVersion":2.3},{"id":"76e206cd-9371-4c8e-9976-764884723456","name":"Merge \"items\" with last response","type":"n8n-nodes-base.set","position":[1296,528],"parameters":{"options":{},"assignments":{"assignments":[{"id":"1e2c8353-5628-4948-abe6-35f8d0f660a5","name":"items","type":"array","value":"={{ [...$('Set \"items\" field').item.json.items, ... $('Get ranked keywords').item.json.tasks[0].result[0].items]}}"}]}},"typeVersion":3.4},{"id":"c8fb1200-86ca-4607-aad6-8175609156ce","name":"Filter (has new AIO keywords)","type":"n8n-nodes-base.filter","position":[1024,928],"parameters":{"options":{},"conditions":{"options":{"version":3,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"8e1d17fa-ebdd-471f-82c0-607f667bd543","operator":{"type":"array","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.diff }}","rightValue":""}]}},"typeVersion":2.3},{"id":"a63efe2e-a17c-4e6a-9bad-6ca656c6ed1a","name":"Find new AIO keywords","type":"n8n-nodes-base.code","position":[816,928],"parameters":{"jsCode":"let oldKeywords = new Set([]);\nif ($('Aggregate').first().json.data) {\n oldKeywords = new Set($('Aggregate').first().json.data\n  .filter(item => item.Target == $('Get targets').first().json.Domain)\n  .map(item => item.Keyword));\n}\n\nlet newKeywords = [];\nif ($('Merge \"items\" with last response').first().json.items) {\n newKeywords = $('Merge \"items\" with last response').first().json.items\n  .map(item => item.keyword_data.keyword);\n}\n\nlet diff;\nif (oldKeywords.size > 0) {\n  diff = newKeywords.filter(x => !oldKeywords.has(x));\n} else {\n  diff = [];\n}\n\nreturn [\n  {\n    json: {\n      diff\n    }\n  }\n];"},"typeVersion":2,"alwaysOutputData":true},{"id":"8b0f4e2a-6ddd-4461-a6b2-9e9005fa31c5","name":"Split out (items)","type":"n8n-nodes-base.splitOut","position":[144,928],"parameters":{"options":{},"fieldToSplitOut":"items"},"typeVersion":1},{"id":"542718fa-4fdf-4f71-9bc1-2ab3cfb5881d","name":"Loop over targets","type":"n8n-nodes-base.splitInBatches","position":[-16,496],"parameters":{"options":{}},"typeVersion":3}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"e510835e-ad89-499e-b0df-dd90528b31f2","connections":{"Aggregate":{"main":[[{"node":"Clear sheet","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Find new AIO keywords","type":"main","index":0}]]},"Clear sheet":{"main":[[{"node":"Get targets","type":"main","index":0}]]},"Get targets":{"main":[[{"node":"Loop over targets","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Loop over targets","type":"main","index":0}]]},"Has more pages?":{"main":[[{"node":"Set \"items\" field","type":"main","index":0}],[{"node":"Merge \"items\" with last response","type":"main","index":0}]]},"Run every Monday":{"main":[[{"node":"Get previous keywords","type":"main","index":0}]]},"Loop over targets":{"main":[[],[{"node":"Initialize \"items\" field","type":"main","index":0}]]},"Set \"items\" field":{"main":[[{"node":"Get ranked keywords","type":"main","index":0}]]},"Split out (items)":{"main":[[{"node":"Append keyword in sheet","type":"main","index":0}]]},"Get ranked keywords":{"main":[[{"node":"Merge \"items\" with DFS response","type":"main","index":0}]]},"Find new AIO keywords":{"main":[[{"node":"Filter (has new AIO keywords)","type":"main","index":0}]]},"Get previous keywords":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Append keyword in sheet":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Initialize \"items\" field":{"main":[[{"node":"Set \"items\" field","type":"main","index":0}]]},"Filter (has new AIO keywords)":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Merge \"items\" with DFS response":{"main":[[{"node":"Has more pages?","type":"main","index":0}]]},"Merge \"items\" with last response":{"main":[[{"node":"Split out (items)","type":"main","index":0}]]}}}