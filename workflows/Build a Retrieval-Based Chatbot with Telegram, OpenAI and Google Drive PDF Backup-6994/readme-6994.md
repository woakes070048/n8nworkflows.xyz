Build a Retrieval-Based Chatbot with Telegram, OpenAI and Google Drive PDF Backup

https://n8nworkflows.xyz/workflows/build-a-retrieval-based-chatbot-with-telegram--openai-and-google-drive-pdf-backup-6994


# Build a Retrieval-Based Chatbot with Telegram, OpenAI and Google Drive PDF Backup

### 1. Workflow Overview

This workflow is designed to build a **Retrieval-Augmented Generation (RAG) chatbot** that integrates **Telegram**, **OpenAI**, and **Google Drive** for document-backed conversational AI. It enables users to upload PDF documents as knowledge sources, which are processed into vector embeddings, stored in-memory for semantic search, and backed up securely on Google Drive. Users can then query this knowledge base interactively via Telegram; the chatbot retrieves relevant information from the embedded documents and responds with context-aware answers.

**Target Use Cases:**  
- Knowledge workers accessing private or corporate documents instantly via chat  
- Support teams querying searchable SOPs and manuals  
- Educators providing Q&A on course materials  
- Individuals automating personal document search with cloud backup  

**Logical Blocks:**

- **1.1 Telegram Chat Input & Handling**: Receives user messages via Telegram, filters message types, routes text queries to the RAG agent, and handles unsupported input types.  
- **1.2 OpenAI RAG Agent for Query Processing**: Uses OpenAI embeddings and chat models to semantically search and generate answers based on the uploaded knowledge base.  
- **1.3 PDF Upload, Processing, and Embedding**: Accepts PDF uploads, extracts text, generates embeddings, inserts them into an in-memory vector store, and backs up original documents to Google Drive.  

---

### 2. Block-by-Block Analysis

#### 2.1 Telegram Chat Input & Handling

- **Overview:**  
  This block listens to incoming Telegram messages, determines if they are text messages, and routes accordingly. Text messages trigger the RAG chatbot agent, and non-text messages receive a polite fallback response.

- **Nodes Involved:**  
  - Telegram Trigger  
  - Is text message? (If node)  
  - Telegram document query agent (entry point for chat processing)  
  - Un-supported message type  
  - Send respond to user  

- **Node Details:**

  1. **Telegram Trigger**  
     - Type: Telegram Trigger  
     - Role: Entry point capturing all Telegram messages sent to the bot.  
     - Configuration: Listens for "message" updates only.  
     - Credentials: Telegram API token associated with the bot.  
     - Input: Incoming Telegram message event.  
     - Output: Passes message data to the next node for type checking.  
     - Failures: Network/auth errors with Telegram API, webhook misconfiguration.

  2. **Is text message?**  
     - Type: If (conditional)  
     - Role: Checks if the incoming Telegram message contains text.  
     - Configuration: Compares message type or content type strictly to "text" (exact expression not explicitly shown but implied).  
     - Inputs: Message JSON from Telegram Trigger.  
     - Outputs:  
       - True branch: message is text â†’ routed to Telegram document query agent.  
       - False branch: message is non-text â†’ routed to unsupported message handler.  
     - Failures: Expression evaluation errors if message format changes.

  3. **Telegram document query agent**  
     - Type: LangChain Agent  
     - Role: Core chatbot logic to process user's text query using embedded knowledge base.  
     - Configuration:  
       - Text input: User's message text.  
       - System message limits output length to 3000 characters after entity parsing.  
       - Uses OpenAI Chat Model and Vector Store retrieval tool internally.  
     - Input: Text message from "Is text message?" true branch.  
     - Output: Generated answer passed to "Send respond to user".  
     - Failures: OpenAI API rate limits, timeout, invalid inputs.

  4. **Un-supported message type**  
     - Type: Telegram node (send message)  
     - Role: Sends a polite fallback message when the input is not text (e.g., images, files).  
     - Configuration: Fixed reply text informing users that only text queries are supported.  
     - Input: From "Is text message?" false branch.  
     - Output: Sends message back to user.  
     - Failures: Telegram API errors, chat ID missing.

  5. **Send respond to user**  
     - Type: Telegram node (send message)  
     - Role: Sends the answer generated by the chatbot back to the Telegram user.  
     - Configuration: Uses dynamic expressions to retrieve the chat ID and answer text.  
     - Input: Response text from "Telegram document query agent".  
     - Output: Sends message to Telegram client.  
     - Failures: Telegram API errors, invalid chat ID.

---

#### 2.2 OpenAI RAG Agent for Query Processing

- **Overview:**  
  Handles embedding generation and semantic retrieval to enable the chatbot to answer questions based on uploaded documents.

- **Nodes Involved:**  
  - Embeddings OpenAI  
  - Insert Data to Store  
  - Query Data Tool  
  - OpenAI Chat Model  
  - Telegram document query agent (also part of this block as it orchestrates the retrieval + chat model)  

- **Node Details:**

  1. **Embeddings OpenAI**  
     - Type: LangChain Embeddings (OpenAI)  
     - Role: Generates vector embeddings for document chunks and queries.  
     - Configuration: Uses OpenAI API with the connected account; no special options configured.  
     - Input: Document text chunks or query text.  
     - Output: Embeddings passed to vector store insertion or retrieval.  
     - Failures: API key issues, rate limits, invalid text input.  
     - Note: Same embedding node used for both insert and retrieve to ensure consistency.

  2. **Insert Data to Store**  
     - Type: LangChain Vector Store (In-Memory)  
     - Role: Inserts document embeddings into an in-memory vector store for fast retrieval.  
     - Configuration: "insert" mode with memory key set to "vector_store_key" for consistent state.  
     - Input: Embeddings from Embeddings OpenAI node applied to document chunks.  
     - Output: Stores embeddings, no direct output connections.  
     - Failures: Memory overflow if too large dataset, concurrency issues.

  3. **Query Data Tool**  
     - Type: LangChain Vector Store (In-Memory)  
     - Role: Retrieval tool that uses the vector store to find relevant document chunks for the query.  
     - Configuration: "retrieve-as-tool" mode, tool named "knowledge_base" with description to assist the chatbot.  
     - Input: Vector store key for retrieval, query embeddings.  
     - Output: Relevant document chunks for the chatbot agent.  
     - Failures: Empty or corrupted vector store, retrieval errors.

  4. **OpenAI Chat Model**  
     - Type: LangChain Chat Model (OpenAI)  
     - Role: Generates natural language answers using GPT-4o-mini model.  
     - Configuration: Model set to "gpt-4o-mini" with default options; connected to OpenAI credential.  
     - Input: User query augmented with retrieved document context.  
     - Output: Chatbot answer text.  
     - Failures: API key issues, rate limits, model availability.

  5. **Telegram document query agent** (as orchestrator)  
     - Combines vector retrieval and chat model to produce final response.

---

#### 2.3 PDF Upload, Processing, and Embedding

- **Overview:**  
  Handles manual PDF uploads, extracts text, embeds document chunks, stores embeddings, and backs up original PDFs to Google Drive.

- **Nodes Involved:**  
  - Upload your PDF document here (Form Trigger)  
  - Default Data Loader  
  - Insert Data to Store (shared with embedding block)  
  - Code (splitting binary data)  
  - Backup document(s) to Google Drive  

- **Node Details:**

  1. **Upload your PDF document here**  
     - Type: Form Trigger  
     - Role: Manual entry point where users upload one or more PDF files.  
     - Configuration: Single file upload field, accepts only ".pdf" files, required.  
     - Output: Binary file data sent to processing nodes.  
     - Failures: Upload size limits, unsupported file types.

  2. **Default Data Loader**  
     - Type: LangChain Document Default Data Loader  
     - Role: Reads uploaded PDFs and splits text into manageable chunks for embedding.  
     - Configuration: Data type set to "binary" to handle file input.  
     - Input: Binary PDF files from form trigger.  
     - Output: Text chunks for embedding.  
     - Failures: Corrupted PDF files, text extraction failure.

  3. **Insert Data to Store**  
     - Same as 2.2, used here to insert document chunksâ€™ embeddings into vector store.  
     - Input: Text chunks â†’ embeddings â†’ insert.  
     - Output: None.  
     - Failures: As above.

  4. **Code**  
     - Type: Code (JavaScript)  
     - Role: Splits multiple binary files labeled with "CV_" prefix into individual items for processing.  
     - Configuration: Custom JS to map binary data keys starting with "CV_" into separate items.  
     - Input: Binary data from form trigger.  
     - Output: Multiple items each containing one PDF binary file.  
     - Failures: Unexpected binary data format, JS runtime errors.

  5. **Backup document(s) to Google Drive**  
     - Type: Google Drive node  
     - Role: Uploads original PDF files to a specified Google Drive folder for backup and future reference.  
     - Configuration:  
       - File name dynamically generated with timestamp and original file name.  
       - Drive and folder IDs fixed to "My Drive" and a specific folder ID respectively.  
       - Uses OAuth2 credentials for Google Drive access.  
     - Input: Binary PDF files from Code node.  
     - Output: None.  
     - Failures: Google API errors, permission issues, folder ID invalid.

---

### 3. Summary Table

| Node Name                      | Node Type                              | Functional Role                                             | Input Node(s)              | Output Node(s)                   | Sticky Note                                                                                           |
|--------------------------------|--------------------------------------|-------------------------------------------------------------|----------------------------|---------------------------------|-----------------------------------------------------------------------------------------------------|
| Telegram Trigger               | telegramTrigger                      | Captures incoming Telegram messages                         | -                          | Is text message?                 | ### 1. ðŸ“© Telegram Trigger  \nListens for incoming messages from the user via the Telegram bot.      |
| Is text message?               | if                                  | Checks if incoming message is text                           | Telegram Trigger           | Telegram document query agent, Un-supported message type | ### 2. Is Text Message?  \nChecks if incoming message is text; routes accordingly.                  |
| Telegram document query agent  | langchain.agent                     | Processes user queries using RAG agent                       | Is text message? (true)    | Send respond to user             | ### 3. Telegram Document Query Agent (GPT with RAG)  \nUses embeddings and chat model to answer.    |
| Un-supported message type      | telegram                            | Sends fallback for unsupported message types                 | Is text message? (false)   | -                               |                                                                                                     |
| Send respond to user           | telegram                            | Sends chatbot answer back to Telegram user                   | Telegram document query agent | -                             |                                                                                                     |
| Embeddings OpenAI              | langchain.embeddingsOpenAi          | Generates vector embeddings for documents and queries        | Default Data Loader (for insert), Query Data Tool (for retrieve) | Insert Data to Store, Query Data Tool  | ### Embeddings  \nInsert and Retrieve use same embedding node to ensure consistency.               |
| Insert Data to Store           | langchain.vectorStoreInMemory        | Inserts embeddings into in-memory vector store                | Embeddings OpenAI, Default Data Loader | -                         | ### 2.2 Insert Data to Store (Embeddings)  \nConverts chunks into embeddings and stores them.        |
| Query Data Tool               | langchain.vectorStoreInMemory        | Retrieves relevant chunks from vector store for queries       | Embeddings OpenAI          | Telegram document query agent    |                                                                                                     |
| OpenAI Chat Model             | langchain.lmChatOpenAi               | Generates chatbot answers using GPT-4o-mini model             | Telegram document query agent | Telegram document query agent  |                                                                                                     |
| Upload your PDF document here | formTrigger                        | Manual trigger for PDF upload                                  | -                          | Insert Data to Store, Code       | ### 1. Upload Your PDF Document Here  \nManual trigger for uploading and processing PDFs.           |
| Default Data Loader           | langchain.documentDefaultDataLoader | Extracts and chunks text from uploaded PDFs                    | Upload your PDF document here | Insert Data to Store             | ### Default Data Loader  \nExtracts and chunks text for embedding.                                  |
| Code                         | code                               | Splits multiple binary files into individual items             | Upload your PDF document here | Backup document(s) to Google Drive |                                                                                                     |
| Backup document(s) to Google Drive | googleDrive                     | Uploads original PDFs to Google Drive for backup               | Code                       | -                               | ### 2.1 Backup Documents to Google Drive  \nUploads original PDFs to connected Google Drive folder. |
| Sticky Note / Comments        | stickyNote                         | Provides documentation, instructions, or visual aid           | -                          | -                               | Various notes describing blocks, usage, and external links (see detailed notes).                    |

---

### 4. Reproducing the Workflow from Scratch

1. **Setup Credentials**:  
   - Create Telegram Bot via [BotFather](https://t.me/botfather) and save the API token. Configure Telegram API credentials in n8n.  
   - Obtain OpenAI API key with GPT and embeddings access; configure OpenAI credentials.  
   - Setup Google Drive OAuth2 credentials with write access to desired folder.

2. **Create Telegram Trigger Node**  
   - Node Type: Telegram Trigger  
   - Configure to listen for "message" updates only.  
   - Attach Telegram credentials.

3. **Add If Node to Check Message Type**  
   - Node Type: If  
   - Condition: Check if incoming message type is "text" (use expression testing `$json["message"]["text"]` or equivalent).  
   - Connect Telegram Trigger â†’ If node.

4. **Add Telegram Document Query Agent (LangChain Agent)**  
   - Node Type: LangChain Agent  
   - Configure input text with expression: `{{$json.message.text}}`  
   - Set system message with output length limit (e.g., max 3000 chars).  
   - Connect the "true" output of the If node to this node.

5. **Configure OpenAI Chat Model Node**  
   - Node Type: LangChain Chat Model (OpenAI)  
   - Select model "gpt-4o-mini" or preferred GPT model.  
   - Connect this node as the chat model for the Agent node.

6. **Create Embeddings OpenAI Node**  
   - Node Type: LangChain Embeddings OpenAI  
   - Connect this node to both Insert Data to Store and Query Data Tool nodes.

7. **Create Vector Store Insert Node**  
   - Node Type: LangChain Vector Store InMemory  
   - Mode: "insert"  
   - Memory key: "vector_store_key" (consistent key)  
   - Connect output of Embeddings OpenAI and Default Data Loader to this node.

8. **Create Vector Store Query Tool Node**  
   - Node Type: LangChain Vector Store InMemory  
   - Mode: "retrieve-as-tool"  
   - Tool name: "knowledge_base"  
   - Tool description: "Use this knowledge base to answer questions from the user"  
   - Use same memory key as Insert node.  
   - Connect Embeddings OpenAI output to this node.

9. **Connect Query Tool and Chat Model to Agent**  
   - Connect Query Data Tool to Agent as "ai_tool" input.  
   - Connect OpenAI Chat Model to Agent as "ai_languageModel" input.

10. **Add Telegram Send Message Node**  
    - Node Type: Telegram  
    - Text: Use expression `={{ $json.output }}` (response from Agent)  
    - Chat ID: Use `={{ $json.message.chat.id }}` from Telegram Trigger node  
    - Connect Agent output to this node.

11. **Add Unsupported Message Node**  
    - Node Type: Telegram  
    - Text: Fixed polite message: "Sorry, I canâ€™t read files or images right now. Just send me your question about uploaded document, and Iâ€™ll help you answer it!"  
    - Chat ID: Same as above.  
    - Connect "false" output of If node to this.

12. **Create Form Trigger Node for PDF Upload**  
    - Node Type: Form Trigger  
    - Configure form title and a required file upload field accepting ".pdf" files only.

13. **Add Default Data Loader**  
    - Node Type: LangChain Document Default Data Loader  
    - Set data type to "binary" to read PDF binaries.  
    - Connect Form Trigger output to this node.

14. **Connect Default Data Loader to Insert Data to Store**  
    - Connect output of Data Loader to Vector Store Insert node.

15. **Add Code Node to Split Binary Files**  
    - Node Type: Code (JavaScript)  
    - Use JS code to extract multiple binary files labeled with "CV_" prefix into separate items.  
    - Connect Form Trigger output to this node.

16. **Add Google Drive Node to Backup PDFs**  
    - Node Type: Google Drive  
    - Configure with Google Drive credentials.  
    - Set file name dynamically (e.g., `document-{{ $now.toFormat("yyyyLLdd-HHmmss") }}-{{$binary.data.fileName}}`).  
    - Target desired Drive and folder ID.  
    - Connect Code node output to this node.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                  | Context or Link                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| Telegram Bot creation and setup instructions via [BotFather](https://t.me/botfather).                                                                                                                                                         | Telegram Bot Setup                                                                                         |
| OpenAI API key required for embeddings and GPT-4o-mini chat model.                                                                                                                                                                            | OpenAI API documentation                                                                                   |
| Google Drive OAuth2 setup recommended with folder ID for backups.                                                                                                                                                                             | Google Drive API and Folder Setup                                                                           |
| Sample document link for testing: [Pearson Sample PDF](https://ptgmedia.pearsoncmg.com/images/9780138203283/samplepages/9780138203283_Sample.pdf)                                                                                           | Sample PDF to test ingestion                                                                                |
| Workflow visual reference screenshot available in sticky note image link.                                                                                                                                                                     | [Screenshot](https://wisestackai.s3.ap-southeast-1.amazonaws.com/Screenshot+2025-08-05+at+1.18.12%E2%80%AFPM.png) |
| The same embeddings node is used for both inserting and retrieving vectors to ensure consistent embedding space and avoid semantic mismatches.                                                                                                | Embeddings consistency best practice                                                                        |
| Non-text messages (files, images, unsupported types) are politely declined with instructions to send text queries only.                                                                                                                       | User experience design                                                                                       |
| The workflow can be extended with automatic PDF ingestion from cloud storage, Telegram file uploads, or logging user questions into a database.                                                                                             | Customization ideas                                                                                          |
| Built with: Telegram + PDF + OpenAI Embeddings + Google Drive + n8n                                                                                                                                                                            | Technology stack                                                                                            |

---

**Disclaimer:** The provided text and workflow are generated exclusively from an automated n8n workflow, strictly respecting all applicable content policies. It does not contain illegal, offensive, or protected content. All manipulated data are legal and public.