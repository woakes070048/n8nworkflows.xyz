Scrape Google Maps leads to Google Sheets via Apify

https://n8nworkflows.xyz/workflows/scrape-google-maps-leads-to-google-sheets-via-apify-6634


# Scrape Google Maps leads to Google Sheets via Apify

### 1. Workflow Overview

This workflow automates the process of scraping business leads from Google Maps using an Apify actor and appending the extracted data into a Google Sheets spreadsheet. It is designed primarily for marketers, sales professionals, and entrepreneurs who want to gather localized business information efficiently.

The workflow is logically divided into the following blocks:

- **1.1 Input Reception:** Manual trigger to start the workflow.
- **1.2 Apify Task Execution:** Runs the Apify Google Maps Scraper actor task and waits for its completion.
- **1.3 Data Retrieval:** Fetches the resulting dataset from Apify once the scraping task is complete.
- **1.4 Data Append:** Maps and appends the retrieved business leads data into a designated Google Sheet.
- **1.5 Documentation Block:** A sticky note providing detailed instructions, context, and setup guidance.

---

### 2. Block-by-Block Analysis

#### 1.1 Input Reception

- **Overview:**  
  This block allows manual initiation of the workflow, enabling users to trigger data scraping on demand.

- **Nodes Involved:**  
  - Start workflow (Manual Trigger)

- **Node Details:**

  - **Start workflow (Manual Trigger)**  
    - Type: `n8n-nodes-base.manualTrigger`  
    - Role: Entry point for the workflow.  
    - Configuration: No parameters required; triggers workflow execution manually.  
    - Inputs: None  
    - Outputs: Connected to "Run task" node  
    - Edge cases: None significant; manual trigger depends on user action.  
    - Version Requirements: Compatible with n8n standard manual trigger node.  

#### 1.2 Apify Task Execution

- **Overview:**  
  This block runs the Google Maps Scraper task on Apify and waits for it to complete to ensure data availability.

- **Nodes Involved:**  
  - Run task  
  - Wait

- **Node Details:**

  - **Run task (Apify Actor Task Execution)**  
    - Type: `@apify/n8n-nodes-apify.apify`  
    - Role: Launches the pre-configured Apify task that scrapes Google Maps data.  
    - Configuration:  
      - Resource: Actor tasks  
      - Operation: Run task  
      - Actor Task ID: Set dynamically via parameter `={{YOUR_APIFY_TASK_ID}}` (user must provide Apify task ID).  
      - Wait for Finish: 10 seconds (waits for the task to complete or timeout).  
    - Input: From Manual Trigger  
    - Output: To Wait node  
    - Credentials: Requires Apify API credentials configured with name "Apify account 2".  
    - Edge cases:  
      - Task failure or timeout if scraping takes longer than wait period.  
      - API authentication errors.  
      - Invalid or missing task ID.  
    - Version: Apify node v1.

  - **Wait (Pause Execution)**  
    - Type: `n8n-nodes-base.wait`  
    - Role: Pauses workflow for 60 seconds to ensure Apify task data is ready.  
    - Configuration: Wait 60 seconds.  
    - Input: From Run task node  
    - Output: To "Get last run" node  
    - Edge cases: None significant.  
    - Version: Standard n8n node v1.1.

#### 1.3 Data Retrieval

- **Overview:**  
  Retrieves the dataset generated by the last run of the Apify actor task.

- **Nodes Involved:**  
  - Get last run  
  - Get dataset items

- **Node Details:**

  - **Get last run (Apify Actor Last Run Info)**  
    - Type: `@apify/n8n-nodes-apify.apify`  
    - Role: Fetches metadata for the latest run of the specified Apify actor.  
    - Configuration:  
      - Operation: Get last run  
      - Actor ID: User parameter `{{YOUR_ACTOR_ID}}` to specify the Google Maps Scraper actor.  
    - Input: From Wait node  
    - Output: To Get dataset items node  
    - Credentials: Uses Apify API credentials ("Apify account 2").  
    - Edge cases:  
      - Invalid actor ID or missing actor ID parameter.  
      - API rate limits or authentication failures.  
    - Version: Apify node v1.

  - **Get dataset items (Fetch Scraped Data)**  
    - Type: `@apify/n8n-nodes-apify.apify`  
    - Role: Retrieves the scraped business leads data from Apify dataset.  
    - Configuration:  
      - Resource: Datasets  
      - Operation: Get items  
      - Dataset ID: Dynamic expression `={{ $json.defaultDatasetId }}` extracted from the previous node output.  
    - Input: From Get last run node  
    - Output: To Append row in sheet node  
    - Credentials: Uses Apify API credentials ("Apify account 2").  
    - Edge cases:  
      - Dataset ID might be missing or invalid if last run data incomplete.  
      - Large datasets might require pagination handling (not shown here).  
    - Version: Apify node v1.

#### 1.4 Data Append

- **Overview:**  
  Maps the dataset fields into predefined columns and appends each business lead as a new row in a specified Google Sheet.

- **Nodes Involved:**  
  - Append row in sheet

- **Node Details:**

  - **Append row in sheet (Google Sheets Append)**  
    - Type: `n8n-nodes-base.googleSheets`  
    - Role: Adds each lead as a new row into the selected Google Sheets document and tab.  
    - Configuration:  
      - Operation: Append  
      - Document ID: User parameter `={{YOUR_SPREADSHEET_ID}}` (Google Sheets spreadsheet ID)  
      - Sheet Name/Tab: User parameter `={{YOUR_TAB_NAME}}` (specific tab name)  
      - Columns mapped:  
        - Title → business title/name from `$json.title`  
        - Street → `$json.street`  
        - Postcode → `$json.postalCode`  
        - City → `$json.city`  
        - Website → `$json.website`  
        - Phone → phone number, processed via custom JavaScript expression to normalize Dutch phone numbers by replacing "+31" with leading "0" and removing spaces.  
    - Input: From Get dataset items node (each item corresponds to a business lead).  
    - Output: None (end of chain).  
    - Credentials: Google Sheets OAuth2 credentials named "Google Sheets account".  
    - Edge cases:  
      - Google API quota limits or authentication errors.  
      - Data mismatches if spreadsheet columns do not align or are missing.  
      - Phone normalization may fail if phone field is missing or malformed.  
    - Version: Google Sheets node v4.6.

#### 1.5 Documentation Block

- **Overview:**  
  Provides detailed notes and setup instructions for users to understand and configure the workflow properly.

- **Nodes Involved:**  
  - Sticky Note

- **Node Details:**

  - **Sticky Note**  
    - Type: `n8n-nodes-base.stickyNote`  
    - Role: Contains a comprehensive description of the workflow, target audience, detailed steps, and setup instructions including required parameters and column headers in the Google Sheet.  
    - Configuration: Static text block (non-executable).  
    - Position: Detached from main nodes, for user reference only.  
    - Content highlights:  
      - Use case explanation  
      - Workflow steps overview  
      - How to configure Apify task, actor, dataset ID, and Google Sheets integration  
      - Required Google Sheet columns: Title, Street, Postcode, City, Website, Phone  
    - Edge cases: None  
    - Version: Standard n8n node.

---

### 3. Summary Table

| Node Name         | Node Type                      | Functional Role                | Input Node(s)      | Output Node(s)       | Sticky Note                                                                                                    |
|-------------------|--------------------------------|-------------------------------|--------------------|----------------------|----------------------------------------------------------------------------------------------------------------|
| Start workflow    | Manual Trigger                 | Workflow initiation            | -                  | Run task             | See "Sticky Note" for detailed workflow description and setup instructions                                    |
| Run task          | Apify Actor Task               | Runs Google Maps Scraper task | Start workflow     | Wait                 | See "Sticky Note"                                                                                              |
| Wait              | Wait                          | Pause for task completion     | Run task           | Get last run         | See "Sticky Note"                                                                                              |
| Get last run      | Apify Actor Last Run Info     | Retrieves last run metadata   | Wait               | Get dataset items    | See "Sticky Note"                                                                                              |
| Get dataset items | Apify Dataset Items           | Fetches scraped data          | Get last run       | Append row in sheet  | See "Sticky Note"                                                                                              |
| Append row in sheet | Google Sheets Append          | Appends lead data to sheet    | Get dataset items  | -                    | See "Sticky Note"                                                                                              |
| Sticky Note       | Sticky Note                   | Documentation and instructions| -                  | -                    | ## Get leads from Google Maps with Apify updated in your Google Sheets<br>## Who's it for<br>This workflow is ideal for marketers, sales professionals, and solo entrepreneurs who want to collect local leads based on Google Maps search terms — for example, restaurants in North Holland.<br>## What it does<br>This workflow uses an Apify actor to scrape business details from Google Maps and automatically appends them to a Google Sheet with the following fields:<br>- Business name<br>- Street<br>- Postal code<br>- City<br>- Website<br>- Phone number<br>## How it works<br>1. The workflow starts with a manual trigger (you can replace it with any other trigger).<br>2. The Google Maps Scraper Apify actor is launched.<br>3. A short wait ensures the actor completes the task (you can increase the wait time for more extensive outputs).<br>4. The resulting dataset is retrieved from Apify.<br>5. Data is mapped and added into a connected Google Sheet.<br>## How to set up<br>Step 1: Configure the “Run Apify scraper” node<br>Go to the Google Maps Scraper actor on Apify.<br>Create a new Task with your search term.<br>Find your actor from list.<br>Step 2: Edit the “Find your last run” node<br>Select the correct actor (Google Maps Scraper) from the dropdown in this node.<br>Step 3: Fetch the dataset<br>In the “Get the data from Apify” node, use {{$json.defaultDatasetId}} to dynamically pull the correct dataset.<br>Step 4: Connect your Google Sheet<br>Link your Google account and select the desired spreadsheet and tab (for example, Leads).<br>Make sure the column headers match the data fields.<br>Current column headers:<br>Title\tStreet\tPostcode\tCity\tWebsite\tPhone |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Manual Trigger Node**  
   - Add a `Manual Trigger` node named **Start workflow**. No configuration needed.

2. **Add Apify Run Task Node**  
   - Add an `Apify` node named **Run task**.  
   - Set resource to **Actor tasks** and operation to **Run task**.  
   - For **Actor Task ID**, set expression to your Apify task ID: `={{YOUR_APIFY_TASK_ID}}` (replace with actual task ID).  
   - Set **Wait for Finish** to 10 seconds.  
   - Connect **Start workflow** output to this node's input.  
   - Configure Apify credentials (OAuth/API key) named e.g., "Apify account 2".

3. **Add Wait Node**  
   - Add a `Wait` node named **Wait**.  
   - Set wait time to 60 seconds (to allow the Apify task to complete).  
   - Connect **Run task** output to this node.

4. **Add Get Last Run Node**  
   - Add an `Apify` node named **Get last run**.  
   - Set operation to **Get last run** for an actor.  
   - For **Actor ID**, use expression `{{YOUR_ACTOR_ID}}` (replace with your Apify actor ID for Google Maps Scraper).  
   - Connect **Wait** output to this node.  
   - Use the same Apify credentials as before.

5. **Add Get Dataset Items Node**  
   - Add an `Apify` node named **Get dataset items**.  
   - Set resource to **Datasets**, operation to **Get items**.  
   - For **Dataset ID**, use expression `={{ $json.defaultDatasetId }}` to dynamically get dataset ID from previous node output.  
   - Connect **Get last run** output to this node.  
   - Use same Apify credentials.

6. **Add Google Sheets Append Node**  
   - Add a `Google Sheets` node named **Append row in sheet**.  
   - Set operation to **Append**.  
   - For **Document ID**, use user input or expression `={{YOUR_SPREADSHEET_ID}}` to specify your Google Sheets file.  
   - For **Sheet Name**, use expression `={{YOUR_TAB_NAME}}` to specify the tab (e.g., "Leads").  
   - Define columns mapping as follows:  
     - Title: `={{ $json.title }}`  
     - Street: `={{ $json.street }}`  
     - Postcode: `={{ $json.postalCode }}`  
     - City: `={{ $json.city }}`  
     - Website: `={{ $json.website }}`  
     - Phone: Use the following JavaScript expression to normalize phone numbers:  
       ```javascript
       (() => {
         const raw = $json.phone || '';
         const digits = raw.replace(/\s+/g, '');
         if (digits.startsWith('+31')) {
           return '0' + digits.slice(3);
         }
         return digits;
       })()
       ```  
   - Connect **Get dataset items** output to this node.  
   - Configure Google Sheets OAuth2 credentials named e.g., "Google Sheets account".

7. **(Optional) Add Sticky Note**  
   - Add a `Sticky Note` node anywhere on the canvas to document workflow usage, configuration instructions, and column headers for easy reference.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Context or Link                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
| This workflow is ideal for marketers, sales professionals, and solo entrepreneurs who want to collect local leads based on Google Maps search terms — e.g., restaurants in North Holland. It scrapes business name, street, postal code, city, website, and phone number, then appends them to a Google Sheet.                                                                                                                                                                                              | Workflow purpose summary                                   |
| Setup requires creating an Apify task from the Google Maps Scraper actor on Apify platform. Obtain your Apify Actor ID and Task ID, and set them as parameters in the workflow nodes.                                                                                                                                                                                                                                                                                                                  | Apify setup instructions                                   |
| Google Sheets tab must have columns matching exactly: Title, Street, Postcode, City, Website, Phone for the data to append correctly.                                                                                                                                                                                                                                                                                                                                                                  | Google Sheets configuration note                           |
| Phone number normalization script replaces Dutch country code "+31" with leading "0" and removes spaces to standardize phone formatting. Adjust script if using other countries or phone formats.                                                                                                                                                                                                                                                                                                     | Data normalization note                                    |
| Increase "Wait" time node duration if scraping large data sets to prevent incomplete data retrieval.                                                                                                                                                                                                                                                                                                                                                                                                | Workflow timing consideration                              |
| Apify API key and Google OAuth2 credentials must be correctly configured in n8n for authentication.                                                                                                                                                                                                                                                                                                                                                                                                  | Credential configuration                                   |

---

This completes the detailed documentation of the "Scrape Google Maps leads to Google Sheets via Apify" workflow. It enables users and developers to understand, reproduce, and maintain the workflow efficiently.