{"id":"wGg4P4JbGq25qxy4","meta":{"instanceId":"52254486b159b349334953c1738da94e90477c7604aa8db2062d11afc0120739","templateCredsSetupCompleted":true},"name":"Product Hunt Lead Generator","tags":[],"nodes":[{"id":"b6f854c1-97c9-436d-baa8-3c6d27e62aac","name":"Prepare CC","type":"n8n-nodes-base.set","notes":"Prepare CC Emails\nConverts the ‚Äúother_emails‚Äù array into a comma-separated string.\nResult saved as field ‚Äúcc‚Äù for direct use in the email node.","position":[5200,1360],"parameters":{"mode":"raw","options":{},"jsonOutput":"={\n\"cc\": \"{{ $('Prepare Request Body2').item.json.contact_info.other_emails?.join(',') || null}}\"\n}"},"notesInFlow":true,"typeVersion":3.4},{"id":"f4b164b1-7346-4e55-bcc1-f0433384668c","name":"Schedule Trigger1","type":"n8n-nodes-base.scheduleTrigger","notes":"## Daily 9AM Trigger \nThis node runs the workflow every day at 9 AM.\nIt starts the automation that checks whether the\nworkflow should perform daily or weekly actions.","position":[-448,1552],"parameters":{"rule":{"interval":[{"triggerAtHour":9}]}},"notesInFlow":true,"typeVersion":1.2},{"id":"d6fb37d1-3993-4b62-a90b-0403e45fd78c","name":"Build Config2","type":"n8n-nodes-base.code","notes":"## Build Config\nThis node creates a config object that stores:\n  - Schedule info (day/time)\n  - Data table and API URLs\n  - External scraper setup (daily + weekly modes)\n  - Webhook configuration details\n  - Email metadata and URLs","position":[-480,1120],"parameters":{"jsCode":"let config = {\n  isScheduleTrigger: $input.first().json.timestamp ? true : false,\n  dataTableId: \"3mOJkgv9zEcXiZP3\",\n  weeklyDay: \"Monday\",\n  currentDay: $now.toFormat('cccc'),\n  isSameDay: true,\n  externalScraper: {\n    baseUrl: \"https://api.apify.com/v2\",\n    payload:{\n      day: {\n        \"scrapeMakers\": true,\n        \"scrapeWebsite\": true,\n        \"archiveDate\": $now.toFormat('yyyy-MM-dd'),\n        \"filter\": {\n          \"topNProducts\": 3\n        },\n        \"saveWebsiteContent\": true\n      },\n      week: {\n        \"scrapeMakers\": true,\n        \"scrapeWebsite\": true,\n        \"archiveWeek\": $now.weekNumber - 1,\n        \"filter\": {\n          \"topNProducts\": 100\n        }\n      },\n      webhook: {\n        \"isAdHoc\": false,\n        \"requestUrl\": \"https://n8n.emp0.com/webhook/product-hunt-scraper-workflow\",\n        \"eventTypes\": [\n            \"ACTOR.RUN.SUCCEEDED\",\n        ],\n        \"condition\": {\n            \"actorId\": \"ralZdliP7uuVVznKq\",\n        },\n        \"payloadTemplate\": `\n          {\n            \"userId\": {{userId}},\n            \"createdAt\": {{createdAt}},\n            \"eventType\": {{eventType}},\n            \"eventData\": {{eventData}},\n            \"resource\": {{resource}}\n          }\n        `,\n        \"doNotRetry\": false,        \n      },\n      contacts: {\n        \"considerChildFrames\": true,\n        \"maxDepth\": 2,\n        \"maxRequests\": 20,\n        \"maxRequestsPerStartUrl\": 10,\n        \"maximumLeadsEnrichmentRecords\": 0,\n        \"mergeContacts\": true,\n        \"sameDomain\": true,\n        \"scrapeSocialMediaProfiles\": {\n            \"facebooks\": true,\n            \"twitters\": true,\n            \"linkedIns\": true,\n            \"instagrams\": true,\n            \"tiktoks\": true,\n            \"pinterests\": true,\n            \"snapchats\": true,\n            \"youtubes\": true,\n        },\n        \"useBrowser\": true\n    }\n    }\n  },\n  email: {\n    prefixes: [\"feedback\", \"sales\", \"hello\"],\n    fromEmail: \"jay@emp0.com\",\n    visitEmail: \"https://emp0.com\",\n    privacyPolicyUrl: \"https://emp0.com/privacy\",\n    termsOfServiceUrl: \"https://emp0.com/terms\",\n    ourWebsite: \"Emp0\"\n  },\n  batch:{\n    size: 10,\n    delay: 6.00\n  }\n};\n\nconfig = {\n  ...config,\n  isSameDay: config.currentDay == config.weeklyDay\n}\n\nreturn config;"},"notesInFlow":true,"typeVersion":2,"alwaysOutputData":true},{"id":"9cb61676-8767-4398-9573-6aa2fcf99fdd","name":"Check Schedule Trigger2","type":"n8n-nodes-base.if","position":[-320,1120],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"ad1eb034-a984-4b58-a809-a33997870624","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $json.isScheduleTrigger }}","rightValue":"1"}]}},"typeVersion":2.2},{"id":"2b48af2a-2be9-448f-a165-0ea08389f35d","name":"Fetch Webhook Status2","type":"n8n-nodes-base.dataTable","notes":"Fetches from the Data Table to see if a webhook\nhas already been created.\n\nLooks for the row where:\n  key = \"IS_WEBHOOK_CREATED\"\n  value = \"1\"\n\nIf found ‚Üí webhook already exists.\nIf not ‚Üí workflow proceeds to create a new one.","position":[96,816],"parameters":{"limit":1,"filters":{"conditions":[{"keyName":"key","keyValue":"IS_WEBHOOK_CREATED"},{"keyName":"value","keyValue":"1"}]},"operation":"get","dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').item.json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1,"alwaysOutputData":true},{"id":"9dbac284-5712-4aae-874c-d6d6f1caf9cc","name":"Check Webhook Exists2","type":"n8n-nodes-base.if","notes":"If YES ‚Üí webhook exists ‚Üí skip creation.\nIf NO ‚Üí webhook missing ‚Üí go create one.","position":[368,816],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"e3f0cb81-9e6e-44ee-9e44-c03f7f9e9b33","operator":{"type":"object","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json }}","rightValue":"1"}]}},"notesInFlow":true,"typeVersion":2.2},{"id":"d4a9a3da-74e7-44e8-a433-9c05387521e5","name":"Create External Webhook2","type":"n8n-nodes-base.httpRequest","notes":"Creates a new webhook using Apify's API.\n\nThe webhook configuration is taken from\nthe 'Build Config' node (payload.webhook object).\n\nUses authenticated POST request to:\n  {{ $('Build Config').item.json.externalScraper.baseUrl }}/webhooks","position":[608,832],"parameters":{"url":"={{ $('Build Config2').item.json.externalScraper.baseUrl }}/webhooks","method":"POST","options":{},"jsonBody":"={{ $('Build Config2').item.json.externalScraper.payload.webhook }}","sendBody":true,"specifyBody":"json","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth"},"credentials":{"httpBearerAuth":{"id":"49J1suZCxH4dgeLB","name":"Bearer YOUR_TOKEN_HERE account"}},"notesInFlow":true,"typeVersion":4.2},{"id":"32232b9e-01e4-4c15-8bc8-190f6ad4bb77","name":"Mark Webhook as Created2","type":"n8n-nodes-base.dataTable","notes":"Inserts a new row into the Data Table to record\nthat the webhook has been successfully created.\n\nAdds:\n  key: \"IS_WEBHOOK_CREATED\"\n  value: \"1\"\n\nThis prevents duplicate webhook creation in future runs.","position":[848,832],"parameters":{"columns":{"value":{"key":"IS_WEBHOOK_CREATED","value":"1"},"schema":[{"id":"key","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"key","defaultMatch":false},{"id":"value","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"value","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').item.json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1},{"id":"6f6dba84-d9a5-41ff-8e3b-05c3bc78c00d","name":"Check Weekly Run (Monday)2","type":"n8n-nodes-base.if","notes":"Compares today's day (currentDay) with the configured weeklyDay (Monday)\nfrom the 'Build Config' node.\n\nIf it's Monday ‚Üí weekly actions can run + daily actions\nIf not ‚Üí only daily actions proceed.","position":[1120,800],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"dae2c88d-160e-4b01-843e-f10bcea4659d","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $('Build Config2').item.json.isSameDay }}","rightValue":"={{ $('Build Config2').item.json.currentDay }}"}]}},"notesInFlow":true,"typeVersion":2.2},{"id":"f4e40d0e-e333-4abb-a4da-fca7a06e7a0b","name":"Combine Run IDs2","type":"n8n-nodes-base.code","notes":"Merges the results of the weekly and daily scrapes.\n\nCreates a map of run IDs ‚Üí dataset IDs, marking each as:\n  status: false (not processed yet)\n\nIf today matches the weekly day (Monday), it includes both;\notherwise, only daily data.\n\nReturns:\n  {\n    ids: { runId: { status, datasetId } },\n    succeeded: 0\n  }","position":[2096,816],"parameters":{"jsCode":"const idsMap = new Map();\n\nconst setConfig = $('Build Config2').first().json;\nconst input = $input.first().json;\n\nif (setConfig.isSameDay) {\n  const topWeeklyProducts = $('Run Actor \"Weekly Top Products\"2').first().json;\n  const payloadWeek = new Map()\n  payloadWeek.set(\"status\", false)\n  payloadWeek.set(\"datasetId\", topWeeklyProducts.data.defaultDatasetId)\n  const weekIds = Object.fromEntries(payloadWeek)\n  idsMap.set(topWeeklyProducts.data.id.toString(), weekIds);\n}\n\nconst payloadDay= new Map()\npayloadDay.set(\"status\", false)\npayloadDay.set(\"datasetId\", input.data.defaultDatasetId)\nconst dayIds = Object.fromEntries(payloadDay)\nidsMap.set(input.data.id.toString(), dayIds);\n\nconst ids = Object.fromEntries(idsMap);\n\nreturn {\n  ids,\n  succeeded: 0,\n};"},"notesInFlow":true,"typeVersion":2},{"id":"b4d5261b-885a-41e8-8c26-43c9cd03b479","name":"Store Run Data2","type":"n8n-nodes-base.dataTable","notes":"Saves the run results into the Data Table.\n\nInserts a row:\n  key: \"RUNS\"\n  value: JSON.stringify($json)\n\nThis keeps track of all created Apify runs\nfor later processing or analysis.","position":[2336,816],"parameters":{"columns":{"value":{"key":"RUNS","value":"={{ JSON.stringify($json) }}"},"schema":[{"id":"key","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"key","defaultMatch":false},{"id":"value","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"value","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').item.json.dataTableId }}"}},"typeVersion":1},{"id":"62def64c-d289-4355-827c-5da9f369fe17","name":"Receive Apify Webhook2","type":"n8n-nodes-base.webhook","notes":"Receives incoming Apify webhook events.\n\nUsed to detect when an Apify run finishes.\nThe payload includes:\n  - eventType\n  - resource.id (Apify run ID)\n  - userId, createdAt, etc.\n\nTriggers workflow to update Data Table with the run status.","position":[-448,1328],"webhookId":"4dda4d24-6484-4911-9e7e-3746029171d9","parameters":{"path":"product-hunt-scraper-workflow","options":{},"httpMethod":"POST"},"notesInFlow":true,"typeVersion":2.1},{"id":"64ca4f11-85fb-48ed-80e5-1cc62c6bd0d5","name":"Fetch RUNS Data2","type":"n8n-nodes-base.dataTable","notes":"Fetches the \"RUNS\" record from the Data Table.\n\nEach RUNS entry tracks Apify run IDs, dataset IDs,\nand their completion status.\n\nUsed to check and update run progress when webhook arrives.","position":[128,1392],"parameters":{"filters":{"conditions":[{"keyName":"=key","keyValue":"RUNS","condition":"=eq"}]},"operation":"get","returnAll":true,"dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').first().json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1,"alwaysOutputData":true},{"id":"5e638145-58d9-45a3-b7fd-adef57fa12e7","name":"Update Run Status2","type":"n8n-nodes-base.code","notes":"Parses the \"RUNS\" JSON value from the Data Table.\n\nFinds the Apify run ID from the incoming webhook (webId)\nand marks it as completed:\n  payload.ids[webId].status = true\n  payload.succeeded += 1\n\nThen returns the updated payload for writing back.","position":[368,1392],"parameters":{"jsCode":"// 1) Read actorRunId from webhook node\nconst wh = $('Receive Apify Webhook2').first().json;\nconst webId = wh?.body?.resource?.id ?? wh?.resource?.id;\n\n// 2) Walk all incoming rows, update ONLY the matching one, and return it\nconst items = $input.all();\nconst out = [];\n\nfor (const item of items) {\n  let payload;\n  try {\n    payload = JSON.parse(item.json.value); // current string -> object\n  } catch {\n    continue; // skip if malformed\n  }\n\n  if (webId && payload.ids && Object.prototype.hasOwnProperty.call(payload.ids, webId)) {\n    // Update fields inside the JSON payload\n    payload.ids[webId].status = true;\n    payload.succeeded = (payload.succeeded || 0) + 1;\n\n    // Preserve original row shape; only change value (stringify back)\n    const row = { ...item.json };\n    row.value = JSON.stringify(payload);\n\n    // (Optional) bump updatedAt so your table sees a change:\n    // row.updatedAt = new Date().toISOString();\n\n    out.push({ json: row });\n    break; // only one row should match; stop here\n  }\n}\n\n// If no match, return empty (so the Update Data Tables node won‚Äôt touch anything)\nreturn out;\n"},"notesInFlow":true,"typeVersion":2},{"id":"03abb432-7ada-4d6e-9db5-f946a3a21110","name":"Save Updated RUNS Data1","type":"n8n-nodes-base.dataTable","notes":"Updates the existing \"RUNS\" row in the Data Table\nwith the modified payload returned by the Code node.\n\nOverwrites the value column with the new JSON string:\n  {\n    ids: { ...run info... },\n    succeeded: <number>\n  }","position":[608,1392],"parameters":{"columns":{"value":{},"schema":[],"mappingMode":"autoMapInputData","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"filters":{"conditions":[{"keyName":"=id","keyValue":"={{ $json.id }}","condition":"=eq"}]},"options":{},"operation":"update","dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').first().json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1},{"id":"e0e0af51-ce79-445e-a637-7c9d1dff29f8","name":"Extract Dataset IDs2","type":"n8n-nodes-base.code","notes":"Extracts all dataset IDs from the \"RUNS\" payload.\n\nProcess:\n  1. Parses the JSON stored in Data Table 'value'\n  2. Collects each datasetId under parsed.ids\n  3. Returns one item per datasetId for parallel requests\n\nOutput Example:\n[\n  { \"datasetId\": \"abc123\" },\n  { \"datasetId\": \"xyz789\" }\n]","position":[1184,1360],"parameters":{"jsCode":"// let datasetIds = [];\n\n// for (let i = 0; i <= 1; i++) {\n//   const value = $input.first().json.value;\n//   const parsed = JSON.parse(value);\n//   const id = Object.values(parsed.ids)[i]?.datasetId;\n\n//   if (id) {\n//     datasetIds.push({ json: { [`datasetId${i}`]: id } });\n//   }\n// }\n\n// return datasetIds;\n\nconst datasetIds = [];\n\nconst value = $input.first().json.value;\nconst parsed = JSON.parse(value);\n\nfor (const { datasetId } of Object.values(parsed.ids)) {\n  if (datasetId) datasetIds.push({ json: { datasetId } });\n}\n\nreturn datasetIds;\n"},"notesInFlow":true,"typeVersion":2},{"id":"88a39276-0118-417d-91df-74ad8df35889","name":"Switch","type":"n8n-nodes-base.switch","notes":"## Decide Next Action \nApplies logic to decide what happens after updating the RUNS data.\n\nOutput branches:\n  - D&W: Both daily and weekly runs succeeded on same day\n  - onlyDay: Daily run succeeded only\n  - wrD&W: Weekly + daily runs incomplete\n  - wrD: Daily run incomplete\n\nThese outputs route the workflow to the proper follow-up path.","onError":"continueRegularOutput","position":[832,1360],"parameters":{"rules":{"values":[{"outputKey":"D&W","conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"8c2ce4c5-0b98-4392-80c7-fd5732ee3cce","operator":{"type":"string","operation":"equals"},"leftValue":"={{ $node[\"Build Config2\"].json.isSameDay === true && JSON.parse($json.value).succeeded == 2}}\n","rightValue":"true"}]},"renameOutput":true},{"outputKey":"onlyDay","conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"6f9a69a3-c9d7-415b-8532-0656adc7ad75","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $node[\"Build Config2\"].json.isSameDay === false && JSON.parse($json.value).succeeded === 1}}","rightValue":"true"}]},"renameOutput":true},{"outputKey":"wrD&W","conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"ca99de2b-0c51-4231-b189-c62ea9133dc9","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $node[\"Build Config2\"].json.isSameDay === true && JSON.parse($json.value).succeeded < 2}}","rightValue":"false"}]},"renameOutput":true},{"outputKey":"wrD","conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"3f1ae194-fdbb-4133-8529-8fa9e79a4fd3","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $node[\"Build Config2\"].json.isSameDay === false && JSON.parse($json.value).succeeded < 1}}","rightValue":""}]},"renameOutput":true}]},"options":{}},"typeVersion":3.3},{"id":"da30a26b-3d66-4095-841e-5a1bb7dca1aa","name":"Run Actor \"Daily Top Products\"2","type":"n8n-nodes-base.httpRequest","notes":"Runs the Apify Product Hunt scraper for *today*.\n\nPOSTs to the same actor endpoint as the weekly run,\nbut with the daily payload from\n'Build Config'\n\nThe output includes run ID and dataset ID for today‚Äôs scrape.","position":[1792,816],"parameters":{"url":"={{ $('Build Config2').first().json.externalScraper.baseUrl }}/acts/danpoletaev~product-hunt-scraper/runs","method":"POST","options":{},"jsonBody":"={{ $('Build Config2').item.json.externalScraper.payload.day }}","sendBody":true,"specifyBody":"json","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth"},"credentials":{"httpBearerAuth":{"id":"49J1suZCxH4dgeLB","name":"Bearer YOUR_TOKEN_HERE account"}},"notesInFlow":true,"typeVersion":4.2},{"id":"b024f6aa-cdf8-47aa-9494-f5daa3b9cd41","name":"Run Actor \"Weekly Top Products\"2","type":"n8n-nodes-base.httpRequest","notes":"Runs the Apify Product Hunt scraper for the *previous week*.\n\nSends a POST request to Apify.\n\nUses payload from 'Build Config'.\n\nThe run ID and dataset ID returned will later be combined\nwith the daily data in the Code node.","position":[1440,784],"parameters":{"url":"={{ $('Build Config2').item.json.externalScraper.baseUrl }}/acts/danpoletaev~product-hunt-scraper/runs","method":"POST","options":{},"jsonBody":"={{ $('Build Config2').item.json.externalScraper.payload.week }}","sendBody":true,"specifyBody":"json","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth"},"credentials":{"httpBearerAuth":{"id":"49J1suZCxH4dgeLB","name":"Bearer YOUR_TOKEN_HERE account"}},"notesInFlow":true,"typeVersion":4.2},{"id":"fb46df71-3673-495f-ba11-097c342a39eb","name":"Create Daily Log Sheet2","type":"n8n-nodes-base.googleSheets","notes":"Creates a new Google Sheet for today with two tabs (‚ÄúDaily Activities‚Äù + ‚ÄúDaily Summary‚Äù).","position":[128,1808],"parameters":{"title":"=product_import_log_{{ new Date($('Schedule Trigger1').item.json.timestamp)\n  .toISOString()\n  .split('T')[0]\n  .replace(/-/g, '_'); }}","options":{},"resource":"spreadsheet","sheetsUi":{"sheetValues":[{"title":"Daily Activities"},{"title":"Daily Summary"}]}},"credentials":{"googleSheetsOAuth2Api":{"id":"9htdOOlcKSk40TTO","name":"Google Sheets account"}},"notesInFlow":true,"typeVersion":4.7},{"id":"f8299139-6d8f-4d3f-8e0c-90e581df9eac","name":"Extract Sheet Info2","type":"n8n-nodes-base.code","notes":"Runs JavaScript to grab the sheet IDs and format them into one JSON string.","position":[384,1808],"parameters":{"jsCode":"const sheet = {\n  spreadsheetId: $input.first().json.spreadsheetId,\n  dailyActivities: $input.first().json.sheets[0].properties.sheetId,\n  dailySummary: $input.first().json.sheets[1].properties.sheetId\n};\n\nreturn [\n  {\n    json: {\n      sheet: JSON.stringify(sheet)\n    }\n  }\n];"},"notesInFlow":true,"typeVersion":2},{"id":"12bc382d-0463-4751-a581-4092ed0f89ac","name":"Store Sheet Metadata2","type":"n8n-nodes-base.dataTable","notes":"Inserts that info into Data Table for later tracking.","position":[640,1808],"parameters":{"columns":{"value":{"key":"SHEET","value":"={{ $json.sheet }}"},"schema":[{"id":"key","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"key","defaultMatch":false},{"id":"value","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"value","defaultMatch":false}],"mappingMode":"defineBelow","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').item.json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1},{"id":"502c90d2-dcd0-4394-92fe-00d489a362ca","name":"Loop Over Sub Items2","type":"n8n-nodes-base.splitInBatches","notes":"Splits each batch into smaller chunks for URL checks.","position":[1888,1360],"parameters":{"options":{}},"notesInFlow":true,"typeVersion":3},{"id":"5e380a37-ec76-443a-a3d0-07aab84ca6bb","name":"Map Category by Topic2","type":"n8n-nodes-base.code","notes":"Uses keyword matching to assign each project to a logical category (AI, Web Apps, etc).","position":[2832,1360],"parameters":{"jsCode":"const categoryMap = {\n  'Web Apps':               ['saas', 'web app'],\n  'Mobile Apps':            ['iphone', 'android', 'mobile'],\n  'Developer Tools':        ['developer tools', 'api', 'open source', 'github'],\n  'Design Tools':           ['design tools', 'design', 'graphics', 'figma'],\n  'Productivity':           ['productivity', 'task management', 'notes'],\n  'AI & Machine Learning':  ['artificial intelligence', 'machine learning', 'ai'],\n  'E-commerce':             ['e-commerce', 'shopping'],\n  'Marketing':              ['marketing', 'seo', 'email marketing', 'ads'],\n  'Analytics':              ['analytics', 'data', 'metrics'],\n  'Finance':                ['finance', 'fintech', 'payments', 'banking'],\n  'Education':              ['education', 'learning', 'courses'],\n  'Health & Fitness':       ['health', 'fitness', 'wellness'],\n  'Entertainment':          ['entertainment', 'games', 'gaming'],\n  'Social Media':           ['social media', 'social network'],\n  'Communication':          ['communication', 'messaging', 'video', 'chat'],\n  'Business Tools':         ['business', 'crm', 'sales', 'b2b']\n};\n\nconst norm = s => s.trim().toLowerCase();\n\n// Build topic-to-category map\nconst topicToCategory = {};\nfor (const [category, topics] of Object.entries(categoryMap)) {\n  for (const t of topics) {\n    topicToCategory[norm(t)] = category;\n  }\n}\n\n// Category priority (higher index = higher priority for tie-breaking)\nconst categoryPriority = [\n  'Other',\n  'Web Apps',\n  'Mobile Apps',\n  'Entertainment',\n  'Social Media',\n  'Health & Fitness',\n  'Education',\n  'Finance',\n  'E-commerce',\n  'Business Tools',\n  'Communication',\n  'Analytics',\n  'Marketing',\n  'Productivity',\n  'Design Tools',\n  'Developer Tools',\n  'AI & Machine Learning'\n];\n\nfunction matchCategory(topic) {\n  const normalized = norm(topic);\n  \n  // 1. Exact match\n  if (topicToCategory[normalized]) {\n    return topicToCategory[normalized];\n  }\n  \n  // 2. Partial match (topic contains keyword or keyword contains topic)\n  for (const [keyword, category] of Object.entries(topicToCategory)) {\n    if (normalized.includes(keyword) || keyword.includes(normalized)) {\n      return category;\n    }\n  }\n  \n  return null;\n}\n\nconst input = $('Loop Over Sub Items2').all();\nreturn input.map(item => {\n  const raw = item.json.categories;\n  const topicList = Array.isArray(raw)\n    ? raw\n    : String(raw).split(',').map(t => t.trim());\n\n  // Match categories with scoring\n  const categoryScores = {};\n  \n  for (const topic of topicList) {\n    const matched = matchCategory(topic);\n    if (matched) {\n      categoryScores[matched] = (categoryScores[matched] || 0) + 1;\n    }\n  }\n  \n  // Get top 3 categories sorted by score, then by priority\n  let ourCategory = Object.entries(categoryScores)\n    .sort((a, b) => {\n      // Sort by score first\n      if (b[1] !== a[1]) return b[1] - a[1];\n      // Then by priority\n      return categoryPriority.indexOf(b[0]) - categoryPriority.indexOf(a[0]);\n    })\n    .slice(0, 3)  // Max 3 categories\n    .map(([cat]) => cat);\n  \n  // Default to 'Other' if no matches\n  if (ourCategory.length === 0) {\n    ourCategory = ['Other'];\n  }\n  \n  const isReachable = $input.first().json.isReachable;\n  \n  return {\n    json: {\n      ...item.json,\n      category: ourCategory[0],      // Primary category (for backward compatibility)\n      categories: ourCategory,        // Array of 1-3 categories\n      isReachable\n    }\n  };\n});"},"notesInFlow":true,"typeVersion":2},{"id":"b3d8e89b-6532-4df8-b0bb-7964320d229d","name":"Prepare Request Body2","type":"n8n-nodes-base.code","notes":"Validates project data and formats the final clean output for later use (e.g., API insert).","position":[3712,1360],"parameters":{"jsCode":"// use .all() to get the list, and [index] to get the specific item for this iteration\nconst item = $(\"Map Category by Topic2\").all()[0]?.json || {};\nconst contact = $(\"Get Contact Scraper1\").all()[0]?.json || {};\n\nconst description = (item.description || '').trim();\nconst short_description_raw = (item.shortDescription || '').trim();\nconst project_url = item.website?.url || item.websiteUrl || '';\nconst title = (item.name || '').replace(/^\\d+\\.\\s*/, '').trim();\n\nconst skipReasons = [];\n\n// 1. Description check\nif (description.length < 50) {\n  skipReasons.push(\"Description is less than 50 characters\");\n}\n\n// 2. Website / reachability check\nconst isReachable = item.isReachable;\n\nif (!project_url) {\n  skipReasons.push(\"Website URL missing\");\n}\n\nif (project_url && isReachable === false) {\n  skipReasons.push(\"Website not accessible\");\n}\n\nif (skipReasons.length > 0) {\n  return [\n    {\n      json: {\n        title: title || \"Unknown\",\n        project_url,\n        skip_reason: skipReasons.join(\"; \"),\n        _skip: true,\n      },\n    },\n  ];\n}\n\n// 3. Short description trimming\nlet final_short_description = short_description_raw;\nif (final_short_description.length > 160) {\n  final_short_description =\n    final_short_description.slice(0, 160).trim() + \"...\";\n}\n\n// 4. Build safe categories & images\n// FIX: Check 'ourCategory', then fall back to 'categories' (which exists in your input)\nconst rawCategory = item.ourCategory || item.categories;\nconst ourCategory = Array.isArray(rawCategory) ? rawCategory : (rawCategory ? [rawCategory] : []);\nconst images = Array.isArray(item.images) ? item.images : [];\n\n// 5. Final output object\nconst output = {\n  title: title || \"Untitled\",\n  description,\n  short_description: final_short_description,\n  project_url,\n  github_url:\n    Array.isArray(contact.githubs) && contact.githubs.length > 0\n      ? contact.githubs[0]\n      : null,\n  demo_url: null,\n\n  logo_url: item.thumbnailUrl || null,\n  banner_url: images.length > 0 ? images[0] : null,\n\n  category: ourCategory.length > 0 ? ourCategory[0] : null,\n  categories: ourCategory.slice(0, 3),\n\n  tech_stack: Array.isArray(item.techStack) ? item.techStack : [],\n\n  product_hunt_url: item.url || null,\n\n  social_links: {\n    twitter:\n      Array.isArray(contact.twitters) && contact.twitters.length > 0\n        ? contact.twitters[0]\n        : null,\n    linkedin:\n      Array.isArray(contact.linkedIns) && contact.linkedIns.length > 0\n        ? contact.linkedIns[0]\n        : null,\n    facebook:\n      Array.isArray(contact.facebooks) && contact.facebooks.length > 0\n        ? contact.facebooks[0]\n        : null,\n    github:\n      Array.isArray(contact.githubs) && contact.githubs.length > 0\n        ? contact.githubs[0]\n        : null,\n    instagram:\n      Array.isArray(contact.instagrams) && contact.instagrams.length > 0\n        ? contact.instagrams[0]\n        : null,\n    tiktok:\n      Array.isArray(contact.tiktoks) && contact.tiktoks.length > 0\n        ? contact.tiktoks[0]\n        : null,\n    pinterest:\n      Array.isArray(contact.pinterests) && contact.pinterests.length > 0\n        ? contact.pinterests[0]\n        : null,\n    snapchat:\n      Array.isArray(contact.snapchats) && contact.snapchats.length > 0\n        ? contact.snapchats[0]\n        : null,\n    youtube:\n      Array.isArray(contact.youtubes) && contact.youtubes.length > 0\n        ? contact.youtubes[0]\n        : null,\n  },\n\n  contact_info: {\n    primary_email:\n      Array.isArray(contact.emails) && contact.emails.length > 0\n        ? contact.emails[0]\n        : null,\n    other_emails:\n      Array.isArray(contact.emails) && contact.emails.length > 1\n        ? contact.emails.slice(1)\n        : null,\n    primary_phone:\n      Array.isArray(contact.phones) && contact.phones.length > 0\n        ? contact.phones[0]\n        : null,\n    other_phones:\n      Array.isArray(contact.phones) && contact.phones.length > 1\n        ? contact.phones.slice(1)\n        : null,\n  },\n\n  ...(item.website?.email ? { owner_email: item.website.email } : {}),\n};\n\nreturn [{ json: output }];"},"executeOnce":false,"notesInFlow":true,"typeVersion":2},{"id":"00bd85d7-676c-48d6-9ddb-d2b4531e8242","name":"Get Sheet Metadata2","type":"n8n-nodes-base.dataTable","notes":"Fetches the stored Sheet row from Data Table.","position":[3952,1360],"parameters":{"limit":1,"filters":{"conditions":[{"keyName":"key","keyValue":"SHEET"}]},"operation":"get","dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').first().json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1},{"id":"c58b48b7-102c-4b89-9f05-726ab179e4a7","name":"Parse Sheet IDs2","type":"n8n-nodes-base.code","notes":"Converts the stored stringified sheet JSON back into an object so can use its properties in other nodes.","position":[4144,1360],"parameters":{"jsCode":"return {\n  sheet: JSON.parse($input.first().json.value)\n}"},"notesInFlow":true,"typeVersion":2},{"id":"ccf9b354-6f29-472f-8912-5d48cff146ff","name":"Check if Skipped2","type":"n8n-nodes-base.if","notes":"Checks if _skip exists and is true in the ‚ÄúPrepare Request Body‚Äù node. If yes ‚Üí log it to the sheet as an error. If no ‚Üí send it to the API.","position":[4368,1360],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"50ef5b7c-8d36-4b8a-b4eb-76962cb6f785","operator":{"type":"boolean","operation":"exists","singleValue":true},"leftValue":"={{ $('Prepare Request Body2').item.json._skip }}","rightValue":""},{"id":"9eee6a87-b2c7-4049-abee-b0cb69fa4a9e","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $('Prepare Request Body2').item.json._skip }}","rightValue":""}]}},"notesInFlow":true,"typeVersion":2.2},{"id":"0e1ae0f8-ba1b-4961-b88b-b672785851ee","name":"Prepare Error Row2","type":"n8n-nodes-base.code","notes":"Builds a row with error info (status: error, errorMessage, etc.) for skipped items. Always outputs data even if logic fails.","position":[4544,1824],"parameters":{"jsCode":"const input = $('Prepare Request Body2').first().json\nconst req = $('Prepare Request Body2').first().json\n\nconst result = {\n  timestamp: new Date().toISOString(),\n  productName: input.title,\n  productHuntUrl: input.product_hunt_url,\n  websiteUrl: input.project_url,\n  contactEmail: input.owner_email ? input.owner_email : null,\n  category: input.category\n};\n\nreturn [{\n  json: {\n    ...result,  \n    status: \"error\",\n    errorMessage: req._skip || \"\",\n    projectId: null,\n    magicLink: null,\n    emailSent: \"no\"\n  }\n}];"},"notesInFlow":true,"typeVersion":2,"alwaysOutputData":true},{"id":"788020ee-6ee6-4e1f-a5ed-1aaa91f14baf","name":"Format API Result for Sheet2","type":"n8n-nodes-base.code","notes":"Combines the API response with the product‚Äôs original data for Google Sheet logging.","position":[4672,1376],"parameters":{"jsCode":"const input = $('Prepare Request Body2').first().json;\n\n// Ensure safety for optional fields\nconst social = input.social_links || {};\nconst contact = input.contact_info || {};\n\nconst body = {\n  title: input.title,\n  description: input.description,\n  short_description: input.short_description || null,\n  project_url: input.project_url,\n  github_url: input.github_url || null,\n  demo_url: input.demo_url || null,\n  logo_url: input.logo_url || null,\n  banner_url: input.banner_url || null,\n  category: input.category || \"Other\",\n  categories: Array.isArray(input.categories) && input.categories.length > 0 \n    ? input.categories.slice(0, 3) \n    : [input.category || \"Other\"],\n  tags: input.tags || [],\n  tech_stack: input.tech_stack || [],\n  price_model: input.price_model || null,\n  price_amount: input.price_amount || null,\n  price_currency: input.price_currency || \"usd\",\n  // owner_email: input.owner_email || contact.primary_email || \"dev@emp0.com\",\n  product_hunt_url: input.product_hunt_url || null,\n  social_links: {\n    twitter: social.twitter || null,\n    linkedin: social.linkedin || null,\n    facebook: social.facebook || null,\n    instagram: social.instagram || null,\n    youtube: social.youtube || null,\n    github: social.github || null,\n    tiktok: social.tiktok || null,\n    discord: social.discord || null,\n  },\n  contact_info: {\n    primary_email: contact.primary_email || input.owner_email || null,\n    other_emails: contact.other_emails || null,\n    primary_phone: contact.primary_phone || null,\n    other_phones: contact.other_phones || null,\n  }\n};\n\nreturn [{ json: body }];"},"notesInFlow":true,"typeVersion":2},{"id":"29db543c-dc9d-4cc9-944d-cfcac956fa73","name":"Sticky Note133","type":"n8n-nodes-base.stickyNote","position":[4592,1232],"parameters":{"color":6,"width":1920,"height":368,"content":"## Email potential leads"},"typeVersion":1},{"id":"d15f73a8-7e88-4abf-860d-87a8d8c62a0f","name":"Check Owner Email Exists2","type":"n8n-nodes-base.if","notes":"Verifies if owner_email is present in the data from Prepare Request Body.","position":[4912,1376],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"bdc904bd-d62e-43ad-ac68-0740f617bdf0","operator":{"type":"string","operation":"exists","singleValue":true},"leftValue":"={{ $('Prepare Request Body2').item.json.contact_info.primary_email }}","rightValue":""}]}},"notesInFlow":true,"typeVersion":2.2},{"id":"0d823f08-eb43-455b-8dba-5c23dcf3af76","name":"Verify Email Sent Successfully2","type":"n8n-nodes-base.if","notes":"Confirms that the email was accepted and delivered to the correct address.","position":[5648,1360],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"1a022f86-525a-4624-a86c-4c3a199f983c","operator":{"type":"string","operation":"exists","singleValue":true},"leftValue":"={{ $json.error }}","rightValue":""},{"id":"361bf728-d959-4b84-af08-3d73028dd34d","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.error }}","rightValue":"={{ $('Format API Result for Sheet2').item.json.contactEmail }}"}]}},"notesInFlow":true,"typeVersion":2.2,"alwaysOutputData":false},{"id":"9a9c1064-5f42-4a65-bd6a-7728cb85b659","name":"Log API Result to Google Sheet2","type":"n8n-nodes-base.googleSheets","notes":"This node appends the final formatted data (status, project ID, magic link, email status, and error message) to the **Daily Activities** sheet in the linked Google Spreadsheet.\nIt serves as the last step in the workflow to record each API run‚Äôs outcome for tracking and analysis.","position":[6304,1824],"parameters":{"columns":{"value":{},"schema":[{"id":"timestamp","type":"string","display":true,"required":false,"displayName":"timestamp","defaultMatch":false,"canBeUsedToMatch":true},{"id":"productName","type":"string","display":true,"required":false,"displayName":"productName","defaultMatch":false,"canBeUsedToMatch":true},{"id":"productHuntUrl","type":"string","display":true,"required":false,"displayName":"productHuntUrl","defaultMatch":false,"canBeUsedToMatch":true},{"id":"websiteUrl","type":"string","display":true,"required":false,"displayName":"websiteUrl","defaultMatch":false,"canBeUsedToMatch":true},{"id":"contactEmail","type":"string","display":true,"required":false,"displayName":"contactEmail","defaultMatch":false,"canBeUsedToMatch":true},{"id":"category","type":"string","display":true,"required":false,"displayName":"category","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"string","display":true,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"errorMessage","type":"string","display":true,"required":false,"displayName":"errorMessage","defaultMatch":false,"canBeUsedToMatch":true},{"id":"projectId","type":"string","display":true,"required":false,"displayName":"projectId","defaultMatch":false,"canBeUsedToMatch":true},{"id":"magicLink","type":"string","display":true,"required":false,"displayName":"magicLink","defaultMatch":false,"canBeUsedToMatch":true},{"id":"emailSent","type":"string","display":true,"required":false,"displayName":"emailSent","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"autoMapInputData","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"operation":"append","sheetName":{"__rl":true,"mode":"id","value":"={{ $('Parse Sheet IDs2').first().json.sheet.dailyActivities }}"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Parse Sheet IDs2').first().json.sheet.spreadsheetId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"9htdOOlcKSk40TTO","name":"Google Sheets account"}},"notesInFlow":true,"typeVersion":4.7},{"id":"b7d54d21-6d9c-48b0-9684-cc8588138825","name":"Summarize Daily Stats2","type":"n8n-nodes-base.code","notes":"Groups all daily records by date, counting totals (processed, successful, duplicates, failures, and emails). Also calculates the daily failure rate to prepare a clean summary for reporting.","position":[2512,1792],"parameters":{"jsCode":"const records = items.map(item => item.json);\n\n// Helper: extract date (YYYY-MM-DD) from ISO timestamp\nfunction extractDate(isoString) {\n  return isoString ? isoString.split('T')[0] : 'Unknown';\n}\n\n// Group records by date\nconst grouped = {};\n\nfor (const record of records) {\n  const date = extractDate(record.timestamp);\n  if (!grouped[date]) {\n    grouped[date] = {\n      date,\n      totalProcessed: 0,\n      successful: 0,\n      duplicates: 0,\n      failures: 0,\n      failureRate: 0,\n      emailsSent: 0,\n      emailFailures: 0\n    };\n  }\n\n  const group = grouped[date];\n  group.totalProcessed++;\n\n  // Count success/duplicate/error\n  if (record.status === 'success') group.successful++;\n  else if (record.status === 'duplicate') group.duplicates++;\n  else if (record.status === 'error') group.failures++;\n\n  // Email sent tracking\n  if (record.emailSent === 'yes') group.emailsSent++;\n  else if (record.emailSent === 'failed') group.emailFailures++;\n}\n\n// Compute failure rate\nfor (const date in grouped) {\n  const group = grouped[date];\n  group.failureRate = group.totalProcessed\n    ? ((group.failures / group.totalProcessed) * 100).toFixed(2) + '%'\n    : '0%';\n}\n\n// Convert object to array for n8n output\nreturn Object.values(grouped).map(summary => ({ json: summary }));\n"},"notesInFlow":true,"typeVersion":2},{"id":"225859a3-7bf3-4662-88ad-941f8f273b66","name":"Log Daily Summary to Sheet2","type":"n8n-nodes-base.googleSheets","notes":"Appends the summarized daily stats into the **Daily Summary** sheet.\nUsed to keep a compact view of system activity and performance trends per day.","position":[2784,1792],"parameters":{"columns":{"value":{},"schema":[{"id":"date","type":"string","display":true,"removed":false,"required":false,"displayName":"date","defaultMatch":false,"canBeUsedToMatch":true},{"id":"totalProcessed","type":"string","display":true,"removed":false,"required":false,"displayName":"totalProcessed","defaultMatch":false,"canBeUsedToMatch":true},{"id":"successful","type":"string","display":true,"removed":false,"required":false,"displayName":"successful","defaultMatch":false,"canBeUsedToMatch":true},{"id":"duplicates","type":"string","display":true,"removed":false,"required":false,"displayName":"duplicates","defaultMatch":false,"canBeUsedToMatch":true},{"id":"failures","type":"string","display":true,"removed":false,"required":false,"displayName":"failures","defaultMatch":false,"canBeUsedToMatch":true},{"id":"failureRate","type":"string","display":true,"removed":false,"required":false,"displayName":"failureRate","defaultMatch":false,"canBeUsedToMatch":true},{"id":"emailsSent","type":"string","display":true,"removed":false,"required":false,"displayName":"emailsSent","defaultMatch":false,"canBeUsedToMatch":true},{"id":"emailFailures","type":"string","display":true,"removed":false,"required":false,"displayName":"emailFailures","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"autoMapInputData","matchingColumns":[],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{},"operation":"append","sheetName":{"__rl":true,"mode":"id","value":"={{ $('Parse Sheet IDs2').first().json.sheet.dailySummary }}"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Parse Sheet IDs2').first().json.sheet.spreadsheetId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"9htdOOlcKSk40TTO","name":"Google Sheets account"}},"notesInFlow":true,"typeVersion":4.7},{"id":"443d7085-bb40-435e-8554-1734a82ec47f","name":"Get Daily Activities to Sheet2","type":"n8n-nodes-base.googleSheets","notes":"This node gets all processed record details (success, duplicate, error, email status, etc.) to the Daily Activities sheet for raw data tracking.","position":[2224,1792],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"id","value":"={{ $('Parse Sheet IDs2').first().json.sheet.dailyActivities }}"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Parse Sheet IDs2').first().json.sheet.spreadsheetId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"9htdOOlcKSk40TTO","name":"Google Sheets account"}},"notesInFlow":true,"typeVersion":4.7},{"id":"1f699334-c87a-4463-a166-963617e815c7","name":"Aggregate Batch Results2","type":"n8n-nodes-base.aggregate","notes":"Collects and combines results from all processed batches into a single dataset.\nUseful for generating summaries or final output after looping is complete.","position":[1984,1792],"parameters":{"options":{},"fieldsToAggregate":{"fieldToAggregate":[{}]}},"notesInFlow":true,"typeVersion":1},{"id":"396fdd36-8789-4f8f-8263-b580d09a28f5","name":"Clear Old Run Data2","type":"n8n-nodes-base.dataTable","notes":"Deletes all rows from the Data Table except the one with the key **IS_WEBHOOK_CREATED**.\nThis ensures only the latest configuration entry is preserved before a new run begins.","position":[3024,1792],"parameters":{"filters":{"conditions":[{"keyName":"key","keyValue":"IS_WEBHOOK_CREATED","condition":"neq"}]},"options":{},"operation":"deleteRows","dataTableId":{"__rl":true,"mode":"id","value":"={{ $('Build Config2').first().json.dataTableId }}"}},"notesInFlow":true,"typeVersion":1},{"id":"9f1cb6cb-abe6-4fe9-b4a3-1fc5d85fd321","name":"Prepare Scraper Payload1","type":"n8n-nodes-base.code","notes":"Builds the request payload sent to the Contact Details Scraper on Apify.\nTakes project data, formats the structure, and prepares all fields the scraper needs.","position":[3088,1360],"parameters":{"jsCode":"return {\n  \"considerChildFrames\": true,\n        \"maxDepth\": 2,\n        \"maxRequests\": 20,\n        \"maxRequestsPerStartUrl\": 10,\n        \"maximumLeadsEnrichmentRecords\": 0,\n        \"mergeContacts\": true,\n        \"sameDomain\": true,\n        \"scrapeSocialMediaProfiles\": {\n            \"facebooks\": true,\n            \"twitters\": true,\n            \"linkedIns\": true,\n            \"instagrams\": true,\n            \"tiktoks\": true,\n            \"pinterests\": true,\n            \"snapchats\": true,\n            \"youtubes\": true,\n        },\n        \"useBrowser\": true,\n  startUrls: [\n    {\n      \"url\": $('Map Category by Topic2').first().json.websiteUrl\n    }\n  ]\n}"},"notesInFlow":true,"typeVersion":2},{"id":"97123efb-df40-4664-985b-721b73737774","name":"Get Contact Scraper1","type":"n8n-nodes-base.httpRequest","notes":"Sends a synchronous POST request to Apify to get contact details","position":[3344,1360],"parameters":{"url":"=https://api.apify.com/v2/acts/vdrmota~contact-info-scraper/run-sync-get-dataset-items","method":"POST","options":{},"jsonBody":"={{ $json }}","sendBody":true,"specifyBody":"json","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth"},"credentials":{"httpBearerAuth":{"id":"49J1suZCxH4dgeLB","name":"Bearer YOUR_TOKEN_HERE account"}},"notesInFlow":true,"retryOnFail":true,"typeVersion":4.2,"alwaysOutputData":true},{"id":"8314d322-4d53-467c-a335-ac2c3e7f339b","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","notes":"- Runs a single ping to the host domain extracted from the website URL.\n\n- If the host responds, it means the website is online and reachable.","onError":"continueErrorOutput","position":[2240,1376],"parameters":{"url":"={{ $('Loop Over Sub Items2').item.json.websiteUrl }}","options":{"response":{"response":{"neverError":true,"fullResponse":true}}}},"notesInFlow":true,"typeVersion":4.3},{"id":"16ed229b-564a-45cc-a669-d54234748d89","name":"If","type":"n8n-nodes-base.if","notes":"- Reads the ping command output.\n\n- If the output includes ‚Äúbytes from‚Äù, it marks the website as reachable.\n\n### Output Format:\n- website ‚Üí The original site URL.\n\n- reachable ‚Üí true if ping succeeded, false if it failed.","position":[2528,1392],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"7013e778-b39c-4d7b-9e9a-3751dca49642","operator":{"type":"number","operation":"equals"},"leftValue":"={{ $json.statusCode }}","rightValue":200}]}},"notesInFlow":true,"typeVersion":2.2},{"id":"d33e936f-b6f5-4b40-bc95-2af1c72bb9d7","name":"If1","type":"n8n-nodes-base.if","position":[3520,1360],"parameters":{"options":{},"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"a1126178-4a82-47e7-91bb-a43dad564468","operator":{"type":"object","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json }}","rightValue":""}]}},"typeVersion":2.2},{"id":"d8ba6159-25c9-4ac5-b92a-6b4f728a35ce","name":"Send a message","type":"n8n-nodes-base.gmail","notes":"Sends a ‚ÄúProduct Featured‚Äù email to the product owner.","onError":"continueRegularOutput","position":[5424,1360],"webhookId":"a0e0acd7-c23f-47d5-bde2-854c240d656d","parameters":{"sendTo":"={{ $('Prepare Request Body2').item.json.contact_info.primary_email }}","message":"=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Emp0 x {{$('Prepare Request Body2').first().json.title }}</title>\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      line-height: 1.6;\n      color: #0f172a;\n      background: #f6f7fb;\n      margin: 0;\n      padding: 0;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 20px;\n    }\n    .header {\n      background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);\n      padding: 28px;\n      text-align: center;\n      border-radius: 12px;\n    }\n    .header img {\n      max-width: 120px;\n      margin-bottom: 10px;\n    }\n    .header h1 {\n      color: #ffffff;\n      margin: 0;\n      font-size: 24px;\n    }\n    .content {\n      background: #ffffff;\n      padding: 28px;\n      border-radius: 12px;\n      margin-top: 20px;\n    }\n    .button {\n      display: inline-block;\n      background: #16a34a;\n      color: #ffffff;\n      padding: 14px 28px;\n      text-decoration: none;\n      border-radius: 8px;\n      font-weight: bold;\n      margin: 20px 0;\n    }\n    .button:hover {\n      background: #15803d;\n    }\n    .footer {\n      text-align: center;\n      margin-top: 30px;\n      color: #64748b;\n      font-size: 13px;\n    }\n    ul {\n      padding-left: 20px;\n    }\n  </style>\n</head>\n\n<body>\n  <div class=\"container\">\n\n    <!-- Header -->\n    <div class=\"header\">\n      <img src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSiQqvP9mSAN_KNxZlbvD9VT-yl4Vf_PuT6Cw&s\" alt=\"Wordpress Logo\" />\n      <h1>üëÄ We spotted your Product Hunt launch</h1>\n    </div>\n\n    <!-- Main Content -->\n    <div class=\"content\">\n      <h2>Hi {{ $('Prepare Request Body2').item.json.contact_info.primary_email }},</h2>\n\n      <p>\n        We came across <strong>{{$('Prepare Request Body2').first().json.title }}\"</strong> on Product Hunt and genuinely liked what you're building.\n      </p>\n\n      <p>\n        I'm Jay from <strong>Emp0</strong>.  \n        We help founders turn early traction into <strong>repeatable growth</strong> using AI and automation.\n      </p>\n\n      <p><strong>Typical things we help PH founders with:</strong></p>\n      <ul>\n        <li>‚öôÔ∏è Automating lead capture & follow-ups after launch</li>\n        <li>üì£ Turning PH traffic into content, email, and retargeting flows</li>\n        <li>ü§ñ Deploying AI agents trained on your product & positioning</li>\n        <li>üìà Setting up systems that scale without hiring more people</li>\n      </ul>\n\n      <p>\n        If you want, we can do a <strong>quick 15-minute teardown</strong> of your current setup and suggest what to automate first.\n      </p>\n\n      <div style=\"text-align:center;\">\n        <a href=\"https://emp0.com/contact\" class=\"button\">\n          Book a Quick Intro Call ‚Üí\n        </a>\n      </div>\n\n      <p style=\"font-size: 14px; color: #64748b;\">\n        No pitch deck. No pressure. Just practical ideas you can steal.\n      </p>\n\n      <hr style=\"border:none; border-top:1px solid #e5e7eb; margin:30px 0;\" />\n\n      <h3>What is EMP0?</h3>\n      <p>\n        EMP0 is an AI automation studio building ‚Äúdigital employees‚Äù for modern teams.\n        Think internal tools, growth systems, and AI workflows that actually ship.\n      </p>\n\n      <p>\n        We work with indie hackers, startups, and lean teams globally.\n      </p>\n    </div>\n\n    <!-- Footer -->\n    <div class=\"footer\">\n      <p>Not relevant? Feel free to ignore this email.</p>\n      <p>\n        Questions? Reply here or visit\n        <a href=\"https://emp0.com\" target=\"_blank\">emp0.com</a>\n      </p>\n\n      <p style=\"margin-top:16px;\">\n        ¬© 2025 Employee Number Zero LLC<br />\n        <a href=\"https://emp0.com/privacy-policy\">Privacy Policy</a> |\n        <a href=\"https://emp0.com/terms-of-service\">Terms</a>\n      </p>\n    </div>\n\n  </div>\n</body>\n</html>\n","options":{"ccList":"={{ $json.cc }}","appendAttribution":false},"subject":"=AI + Automation services for \"{{ $('Prepare Request Body2').first().json.title }}\""},"credentials":{"gmailOAuth2":{"id":"mVjBYT4G0UI8mP25","name":"Gmail account 2"}},"notesInFlow":true,"typeVersion":2.1},{"id":"cb98f79a-22fa-4450-bcac-1497584a76a5","name":"Handle Email Failed","type":"n8n-nodes-base.code","position":[5888,1824],"parameters":{"jsCode":"const prev =  $('Format API Result for Sheet2').first().json || {};\n\nreturn [{\n  json: {\n    ...prev,  \n    status: \"success\",\n    errorMessage: $input.first().json.error,\n    emailSent: \"failed\"\n  }\n}];"},"typeVersion":2,"alwaysOutputData":true},{"id":"1667ba94-ae37-48cd-87a0-591e3471c4a0","name":"Handle Email Success","type":"n8n-nodes-base.code","position":[6112,1824],"parameters":{"jsCode":"const prev =  $('Format API Result for Sheet2').first().json || {};\n\nreturn [{\n  json: {\n    ...prev,  \n    status: \"success\",\n    errorMessage: null,\n    emailSent: \"yes\"\n  }\n}];"},"typeVersion":2,"alwaysOutputData":true},{"id":"823fa7c4-5488-42fb-a42b-050cf8fc08ac","name":"Handle No Email","type":"n8n-nodes-base.code","position":[5248,1824],"parameters":{"jsCode":"const prev =  $('Format API Result for Sheet2').first().json || {};\n\nreturn [{\n  json: {\n    ...prev,  \n    status: \"success\",\n    errorMessage: null,\n    emailSent: \"no\"\n  }\n}];"},"typeVersion":2,"alwaysOutputData":true},{"id":"eaadb8f6-9663-43b6-b31b-8dcb6c18cf87","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[5152,400],"parameters":{"color":6,"width":624,"height":1168,"content":"![Email Blast Template](https://articles.emp0.com/wp-content/uploads/2025/12/product-hunt-scraper-email-blast.png)"},"typeVersion":1},{"id":"8b084b4e-b3ad-4e68-a573-eb3ca4e4264c","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[64,1712],"parameters":{"color":4,"width":6448,"height":256,"content":"## Log crawling status and results to Gsheet and DataTables"},"typeVersion":1},{"id":"0f207eab-0a0a-4bd6-b1c2-064b56c79f31","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[48,720],"parameters":{"color":7,"width":2528,"height":288,"content":"## Initiate the scrape"},"typeVersion":1},{"id":"c37e5bc4-6c1b-40ca-ac35-cf669afa763c","name":"Deduplicate2","type":"n8n-nodes-base.code","notes":"Removes duplicate items based on the \"name\" field.\n\nLogic:\n  - Tracks seen 'name' values\n  - Keeps only the first occurrence of each name\n  - Keeps items without 'name' unchanged\n\nEnsures unique data entries before processing or storing.","position":[1616,1360],"parameters":{"jsCode":"\nconst UNIQUE_KEY = 'name';\n\nconst allItems = $input.all();\nconst seen = new Set();\nconst unique = [];\n\nfor (const item of allItems) {\n\n  const key = item.json[UNIQUE_KEY].replace(/^\\d+\\.\\s*/, '').trim();\n  if (key !== undefined && !seen.has(key)) {\n    seen.add(key);\n    unique.push(item);\n  } else if (key === undefined) {\n    unique.push(item);\n  }\n}\n\nreturn unique.map(i => ({ json: i.json }));"},"notesInFlow":true,"typeVersion":2},{"id":"e4a24245-4974-4ef7-ac7e-1b1952e5ebb4","name":"Fetch Dataset Items2","type":"n8n-nodes-base.httpRequest","notes":"Fetches all items from each Apify dataset using datasetId.\n\nUses Apify Auth credentials for authorization.\nThis pulls raw scraped data.","position":[1392,1360],"parameters":{"url":"={{ $('Build Config2').first().json.externalScraper.baseUrl }}/datasets/{{ $json.datasetId }}/items\n","options":{},"sendHeaders":true,"authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","headerParameters":{"parameters":[{}]}},"credentials":{"httpBearerAuth":{"id":"49J1suZCxH4dgeLB","name":"Bearer YOUR_TOKEN_HERE account"}},"notesInFlow":true,"typeVersion":4.2},{"id":"bde3b242-6fd7-47f7-b4bb-45d6dca2bb98","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[48,1232],"parameters":{"color":3,"width":1728,"height":368,"content":"## Get the dataset after the scraper has completed"},"typeVersion":1},{"id":"c48683a2-c668-4b46-a6a8-e70418f3214f","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[1808,1232],"parameters":{"color":5,"width":2736,"height":368,"content":"## Retreive the contact details from each website"},"typeVersion":1},{"id":"7a727437-7557-4ece-8538-e96b2caa7ac6","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[-1104,992],"parameters":{"width":928,"height":880,"content":"# Product Hunt Lead Generator\n\nAutomatically scrapes Product Hunt daily for new products, enriches contact info, and exports to Google Sheets.\n\n## How It Works:\n1. Apify actors scrape Product Hunt (top 50 daily + top 100 weekly)\n2. Contact info extracted (emails, LinkedIn, Twitter, phone)\n3. MongoDB prevents duplicates via vector search\n4. Data exported to Google Sheets\n5. Optional: Gmail sends personalized outreach\n\n## Quick Setup:\n- Configure Build Config2 node (Data Table ID, webhook URL, email settings)\n- Add credentials: Apify (Bearer YOUR_TOKEN_HERE), Google Sheets, Gmail, MongoDB\n- Create n8n Data Table (key/value columns)\n- Activate workflow and test\n\nCost: ~$65-95/month | Generates 1,900+ leads/month\n\n- **How it works** ‚Üí [README.md](https://github.com/Jharilela/n8n-workflows/blob/main/Product%20Hunt%20Lead%20Generator/README.md)\n- **Full Setup Guide** ‚Üí [Technical Setup Guide](https://github.com/Jharilela/n8n-workflows/blob/main/Product%20Hunt%20Lead%20Generator/Technical%20Setup.md)\n\n- **Product Hunt Scraper** ‚Üí [Scrape Product Hunt](https://console.apify.com/actors/ralZdliP7uuVVznKq/input)\n- **Contact Info Scraper** ‚Üí [Extract Contact Details](https://apify.com/vdrmota/contact-info-scraper)\n\n## üìö Full Documentation\nFor detailed setup instructions, troubleshooting, and cost optimization:\n- **Technical Setup Guide**: See [Technical Setup Guide](https://github.com/Jharilela/n8n-workflows/blob/main/Product%20Hunt%20Lead%20Generator/Technical%20Setup.md)\n- **Purchase Workflow**: [0emp0.gumroad.com/l/product-hunt-lead-generator](https://0emp0.gumroad.com/l/product-hunt-lead-generator)\n- **Join Community**: [Skool Community](https://www.skool.com/aia-ai-automation-2762)\n- **Sign up for Apify**: Use [affiliate link](https://www.apify.com/?fpr=99h7ds) or referral code **99h7ds**\n\n---\n\n**Need help?** Reach out via [Discord @jym.god](https://discord.gg/RqMKqA3jMS) or email [jay@emp0.com](mailto:jay@emp0.com)"},"typeVersion":1}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"14099345-4a01-470d-86b1-3bac7228dbf0","connections":{"If":{"main":[[{"node":"Map Category by Topic2","type":"main","index":0}],[{"node":"Loop Over Sub Items2","type":"main","index":0}]]},"If1":{"main":[[{"node":"Prepare Request Body2","type":"main","index":0}],[{"node":"Loop Over Sub Items2","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Extract Dataset IDs2","type":"main","index":0}],[{"node":"Extract Dataset IDs2","type":"main","index":0}]]},"Prepare CC":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Deduplicate2":{"main":[[{"node":"Loop Over Sub Items2","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"If","type":"main","index":0}],[{"node":"Loop Over Sub Items2","type":"main","index":0}]]},"Build Config2":{"main":[[{"node":"Check Schedule Trigger2","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Verify Email Sent Successfully2","type":"main","index":0}]]},"Handle No Email":{"main":[[{"node":"Log API Result to Google Sheet2","type":"main","index":0}]]},"Combine Run IDs2":{"main":[[{"node":"Store Run Data2","type":"main","index":0}]]},"Fetch RUNS Data2":{"main":[[{"node":"Update Run Status2","type":"main","index":0}]]},"Parse Sheet IDs2":{"main":[[{"node":"Check if Skipped2","type":"main","index":0}]]},"Check if Skipped2":{"main":[[{"node":"Prepare Error Row2","type":"main","index":0}],[{"node":"Format API Result for Sheet2","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Build Config2","type":"main","index":0}]]},"Prepare Error Row2":{"main":[[{"node":"Log API Result to Google Sheet2","type":"main","index":0}]]},"Update Run Status2":{"main":[[{"node":"Save Updated RUNS Data1","type":"main","index":0}]]},"Extract Sheet Info2":{"main":[[{"node":"Store Sheet Metadata2","type":"main","index":0}]]},"Get Sheet Metadata2":{"main":[[{"node":"Parse Sheet IDs2","type":"main","index":0}]]},"Handle Email Failed":{"main":[[{"node":"Log API Result to Google Sheet2","type":"main","index":0}]]},"Extract Dataset IDs2":{"main":[[{"node":"Fetch Dataset Items2","type":"main","index":0}]]},"Fetch Dataset Items2":{"main":[[{"node":"Deduplicate2","type":"main","index":0}]]},"Get Contact Scraper1":{"main":[[{"node":"If1","type":"main","index":0}]]},"Handle Email Success":{"main":[[{"node":"Log API Result to Google Sheet2","type":"main","index":0}]]},"Loop Over Sub Items2":{"main":[[{"node":"Aggregate Batch Results2","type":"main","index":0}],[{"node":"HTTP Request","type":"main","index":0}]]},"Check Webhook Exists2":{"main":[[{"node":"Check Weekly Run (Monday)2","type":"main","index":0}],[{"node":"Create External Webhook2","type":"main","index":0}]]},"Fetch Webhook Status2":{"main":[[{"node":"Check Webhook Exists2","type":"main","index":0}]]},"Prepare Request Body2":{"main":[[{"node":"Get Sheet Metadata2","type":"main","index":0}]]},"Map Category by Topic2":{"main":[[{"node":"Prepare Scraper Payload1","type":"main","index":0}]]},"Receive Apify Webhook2":{"main":[[{"node":"Build Config2","type":"main","index":0}]]},"Summarize Daily Stats2":{"main":[[{"node":"Log Daily Summary to Sheet2","type":"main","index":0}]]},"Check Schedule Trigger2":{"main":[[{"node":"Fetch Webhook Status2","type":"main","index":0},{"node":"Create Daily Log Sheet2","type":"main","index":0}],[{"node":"Fetch RUNS Data2","type":"main","index":0}]]},"Create Daily Log Sheet2":{"main":[[{"node":"Extract Sheet Info2","type":"main","index":0}]]},"Save Updated RUNS Data1":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Aggregate Batch Results2":{"main":[[{"node":"Get Daily Activities to Sheet2","type":"main","index":0}]]},"Create External Webhook2":{"main":[[{"node":"Mark Webhook as Created2","type":"main","index":0}]]},"Mark Webhook as Created2":{"main":[[{"node":"Check Weekly Run (Monday)2","type":"main","index":0}]]},"Prepare Scraper Payload1":{"main":[[{"node":"Get Contact Scraper1","type":"main","index":0}]]},"Check Owner Email Exists2":{"main":[[{"node":"Prepare CC","type":"main","index":0}],[{"node":"Handle No Email","type":"main","index":0}]]},"Check Weekly Run (Monday)2":{"main":[[{"node":"Run Actor \"Weekly Top Products\"2","type":"main","index":0}],[{"node":"Run Actor \"Daily Top Products\"2","type":"main","index":0}]]},"Log Daily Summary to Sheet2":{"main":[[{"node":"Clear Old Run Data2","type":"main","index":0}]]},"Format API Result for Sheet2":{"main":[[{"node":"Check Owner Email Exists2","type":"main","index":0}]]},"Get Daily Activities to Sheet2":{"main":[[{"node":"Summarize Daily Stats2","type":"main","index":0}]]},"Log API Result to Google Sheet2":{"main":[[{"node":"Loop Over Sub Items2","type":"main","index":0}]]},"Run Actor \"Daily Top Products\"2":{"main":[[{"node":"Combine Run IDs2","type":"main","index":0}]]},"Verify Email Sent Successfully2":{"main":[[{"node":"Handle Email Failed","type":"main","index":0}],[{"node":"Handle Email Success","type":"main","index":0}]]},"Run Actor \"Weekly Top Products\"2":{"main":[[{"node":"Run Actor \"Daily Top Products\"2","type":"main","index":0}]]}}}