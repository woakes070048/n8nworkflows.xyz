{"meta":{"instanceId":"3ed66a67b0c238239f2bedab8649c4c1bccb59f66091f0a90b6a4631a3523e6a","templateId":"ready-to-run-ai-workflow","templateCredsSetupCompleted":true},"nodes":[{"id":"753b0708-0a28-4031-bfb1-d9adc567a0ab","name":"Sticky Note - Content Generation","type":"n8n-nodes-base.stickyNote","position":[-1504,-1088],"parameters":{"color":7,"width":400,"height":400,"content":"## ğŸ“… Daily Content Generation Flow\n\nTriggers **Monday-Friday at 9:00 AM JST**\n\n**This section**:\n1. Gets Japanese cultural context (seasons, holidays, business events)\n2. Analyzes your past 30 days of posts for brand voice\n3. Generates 3 Twitter post options with GPT-4\n4. Considers current events and cultural appropriateness"},"typeVersion":1},{"id":"caf02274-68f6-4ce7-aa56-f79af9bea8eb","name":"Sticky Note - Quality Scoring","type":"n8n-nodes-base.stickyNote","position":[-832,-1152],"parameters":{"color":7,"width":380,"height":484,"content":"## ğŸ¯ AI Quality Scoring System\n\n**Evaluates content on 100-point scale**:\n- Engagement prediction (30 pts)\n- SEO/discoverability (20 pts)\n- Brand voice alignment (20 pts)\n- Readability (15 pts)\n- CTA clarity (15 pts)\n\nContent scoring **below 70 points** triggers auto-improvement (up to 3 attempts)"},"typeVersion":1},{"id":"e4561ad5-a3be-4aef-a080-6204a9b9f81e","name":"Sticky Note - Improvement","type":"n8n-nodes-base.stickyNote","position":[-416,-1152],"parameters":{"color":7,"width":360,"height":396,"content":"## ğŸ”„ Self-Improvement Loop\n\nIf content scores **< 70 points** and **< 3 improvement attempts**:\n\n1. GPT-4 rewrites based on specific feedback\n2. Re-evaluates with quality scoring\n3. Repeats up to 3 times\n\nAfter 3 attempts or score â‰¥70, proceeds to risk analysis"},"typeVersion":1},{"id":"5729b69f-86d8-47b5-99fd-1c526ae9c4bb","name":"Sticky Note - Risk Analysis","type":"n8n-nodes-base.stickyNote","position":[-32,-1280],"parameters":{"color":7,"width":360,"height":552,"content":"## âš ï¸ Risk & Sentiment Analysis\n\n**Detects**:\n- Political/religious references\n- Gender/discriminatory language\n- Inappropriate disaster/accident mentions\n- Misleading advertising\n- Competitor attacks\n- Cultural taboos\n- Timing issues (mourning periods, etc.)\n\n**Risk levels**: low / medium / high"},"typeVersion":1},{"id":"aabaf71e-f6eb-4058-a84e-69a970e5fe00","name":"Sticky Note - Routing","type":"n8n-nodes-base.stickyNote","position":[448,-960],"parameters":{"color":7,"width":340,"height":504,"content":"## ğŸš¦ Smart Routing Decision\n\n**Auto-approve** (posts immediately):\n- Quality score â‰¥ 70\n- Risk level = low\n\n**Requires approval**:\n- Quality score < 70 OR\n- Risk level = medium\n\n**Auto-reject**:\n- Risk level = high\n\n(Rejected content is saved to Notion for review)"},"typeVersion":1},{"id":"410eb215-935f-4c82-b5f0-1bd1e8580c57","name":"Sticky Note - Auto Approve","type":"n8n-nodes-base.stickyNote","position":[880,-880],"parameters":{"color":7,"width":320,"height":244,"content":"## âœ… Auto-Approved Path\n\n1. Saves to Notion (status: published)\n2. Posts to Twitter automatically\n3. No human intervention needed\n\nFor **high-confidence, low-risk content**"},"typeVersion":1},{"id":"f93e3471-ae8d-4c2c-bd98-5014c105c57f","name":"Sticky Note - Approval Path","type":"n8n-nodes-base.stickyNote","position":[880,-288],"parameters":{"color":7,"width":340,"height":324,"content":"## ğŸ‘¤ Human Approval Path\n\n1. Saves to Notion (status: pending)\n2. Sends email to approval team with:\n   - Content preview\n   - Quality scores\n   - Risk assessment\n   - Improvement history\n3. Awaits approval via webhook\n\n**Use the approval webhook** to approve/reject/edit"},"typeVersion":1},{"id":"ec996c7f-8057-496c-aef8-0e2615b096f0","name":"Sticky Note - Webhook","type":"n8n-nodes-base.stickyNote","position":[-1504,-320],"parameters":{"color":7,"width":360,"height":636,"content":"## ğŸ”— Approval Webhook\n\n**Endpoint**: `/approval-webhook`\n\n**Query parameters**:\n- `action`: approve / reject / edit\n- `id`: content ID from Notion\n\n**Body** (for edits):\n```json\n{\n  \"editedContent\": \"Modified text\",\n  \"approvedBy\": \"user@email.com\"\n}\n```\n\nApproved content gets posted to Twitter"},"typeVersion":1},{"id":"bd65c75e-d488-4c39-8467-d21c4f3824bc","name":"Sticky Note - Analytics","type":"n8n-nodes-base.stickyNote","position":[-1504,336],"parameters":{"color":7,"width":380,"height":512,"content":"## ğŸ“Š Weekly Analytics Report\n\n**Triggers**: Every Monday at 10:00 AM\n\n1. Fetches past week's posts from Notion\n2. GPT-4 analyzes performance data\n3. Generates insights report including:\n   - Performance summary\n   - Top 3 best posts\n   - Posts needing improvement\n   - Discovered trends/patterns\n   - Actionable recommendations\n4. Emails report to team\n\n**Helps optimize** future content strategy"},"typeVersion":1},{"id":"d6008133-2353-4db5-b7c1-e31c09be68ae","name":"Sticky Note - Brand Voice","type":"n8n-nodes-base.stickyNote","position":[-1072,-624],"parameters":{"color":7,"width":360,"height":420,"content":"## ğŸ¨ Brand Voice Learning\n\nAnalyzes your **past 30 days** of posts:\n- Average post length\n- Emoji usage patterns\n- Common hashtags\n- Question-based posts frequency\n- Tone and phrasing\n\nGPT-4 creates a **brand voice profile** to ensure new content matches your established style"},"typeVersion":1},{"id":"006b450d-05ee-4bad-8b93-7f712ca365f7","name":"Schedule Daily Content Generation","type":"n8n-nodes-base.scheduleTrigger","position":[-1456,-608],"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 9 * * 1-5"}]}},"typeVersion":1.1},{"id":"4d9a56a3-0b26-4ea9-9967-1050459bc6c2","name":"Generate Content with GPT-4","type":"n8n-nodes-base.httpRequest","position":[-1232,-800],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯æ—¥æœ¬å¸‚å ´ã«ç‰¹åŒ–ã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚æ—¥æœ¬ã®æ–‡åŒ–ã€å­£ç¯€ã€ãƒ“ã‚¸ãƒã‚¹ç¿’æ…£ã‚’æ·±ãç†è§£ã—ã€é©åˆ‡ãªæ•¬èªã¨è¦ªã—ã¿ã‚„ã™ã„æ–‡ä½“ã§ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢æŠ•ç¨¿ã‚’ä½œæˆã—ã¾ã™ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»Šæ—¥ã¯\" + $now.format('yyyyå¹´MMæœˆddæ—¥(ddd)') + \"ã§ã™ã€‚ä»¥ä¸‹ã®æ¡ä»¶ã§TwitteræŠ•ç¨¿ã‚’3ã¤ä½œæˆã—ã¦ãã ã•ã„:\\n\\n1. ç¾åœ¨ã®å­£ç¯€ã‚„æ—¥æœ¬ã®æ–‡åŒ–çš„ã‚¤ãƒ™ãƒ³ãƒˆã‚’è€ƒæ…®\\n2. ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³å‘ã‘ã®æœ‰ç›Šãªå†…å®¹\\n3. çµµæ–‡å­—ã‚’2-3å€‹ä½¿ç”¨\\n4. 200æ–‡å­—ä»¥å†…\\n5. ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚’ä¿ƒã™CTAã‚’å«ã‚€\\n\\nå„æŠ•ç¨¿ã‚’JSONé…åˆ—ã§è¿”ã—ã¦ãã ã•ã„: [{\\\"content\\\": \\\"æŠ•ç¨¿æ–‡\\\", \\\"hashtags\\\": [\\\"ã‚¿ã‚°1\\\", \\\"ã‚¿ã‚°2\\\"]}]\"}] }}"},{"name":"temperature","value":"0.7"},{"name":"max_tokens","value":"1000"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"bb8094a2-98eb-4e12-aa2c-a3f01a04fec8","name":"Parse Generated Content","type":"n8n-nodes-base.code","position":[-1008,-800],"parameters":{"jsCode":"// Parse GPT-4 response and extract generated content\nconst response = $input.item.json;\nconst content = JSON.parse(response.choices[0].message.content);\n\nconst results = [];\n\nfor (let i = 0; i < content.length; i++) {\n  const post = content[i];\n  results.push({\n    json: {\n      content: post.content,\n      hashtags: post.hashtags,\n      generatedAt: new Date().toISOString(),\n      platform: 'twitter',\n      status: 'pending_quality_check',\n      version: i + 1\n    }\n  });\n}\n\nreturn results;"},"typeVersion":2},{"id":"47c6f1df-ceab-4b18-b22f-4959d4be5760","name":"AI Quality Scoring","type":"n8n-nodes-base.httpRequest","position":[-784,-800],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ªè©•ä¾¡ã®å°‚é–€å®¶ã§ã™ã€‚ä»¥ä¸‹ã®åŸºæº–ã§æŠ•ç¨¿ã‚’100ç‚¹æº€ç‚¹ã§æ¡ç‚¹ã—ã¦ãã ã•ã„:\\n\\n1. ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆäºˆæ¸¬ (30ç‚¹): ã„ã„ã­ãƒ»ãƒªãƒ„ã‚¤ãƒ¼ãƒˆãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç²å¾—ã—ã‚„ã™ã„ã‹\\n2. SEO/ç™ºè¦‹æ€§ (20ç‚¹): ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã¨æ¤œç´¢ã•ã‚Œã‚„ã™ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰\\n3. ãƒ–ãƒ©ãƒ³ãƒ‰ãƒœã‚¤ã‚¹é©åˆ (20ç‚¹): ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§è¦ªã—ã¿ã‚„ã™ã„ãƒˆãƒ¼ãƒ³\\n4. èª­ã¿ã‚„ã™ã• (15ç‚¹): æ–‡æ³•ã€å¥èª­ç‚¹ã€æ”¹è¡Œã®é©åˆ‡ã•\\n5. CTAæ˜ç¢ºã• (15ç‚¹): è¡Œå‹•å–šèµ·ãŒæ˜ç¢ºã‹\\n\\nJSONå½¢å¼ã§è¿”ç­”: {\\\"total_score\\\": 85, \\\"engagement_score\\\": 25, \\\"seo_score\\\": 18, \\\"brand_voice_score\\\": 18, \\\"readability_score\\\": 13, \\\"cta_score\\\": 11, \\\"feedback\\\": \\\"æ”¹å–„ç‚¹ã®èª¬æ˜\\\", \\\"risk_level\\\": \\\"low/medium/high\\\", \\\"risk_reason\\\": \\\"ãƒªã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã®ç†ç”±\\\"}\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„:\\n\\n\" + $json.content + \"\\n\\nãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: \" + $json.hashtags.join(', ')}] }}"},{"name":"temperature","value":"0.3"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"a65792c4-475e-41db-a1bd-9e83a621a983","name":"Parse Quality Scores","type":"n8n-nodes-base.code","position":[-560,-864],"parameters":{"jsCode":"// Parse quality scoring results\nconst scoringResponse = $input.item.json;\nconst scores = JSON.parse(scoringResponse.choices[0].message.content);\n\n// Merge with original content\nconst originalData = $('Parse Generated Content').item.json;\n\nreturn {\n  json: {\n    ...originalData,\n    qualityScore: scores.total_score,\n    engagementScore: scores.engagement_score,\n    seoScore: scores.seo_score,\n    brandVoiceScore: scores.brand_voice_score,\n    readabilityScore: scores.readability_score,\n    ctaScore: scores.cta_score,\n    feedback: scores.feedback,\n    riskLevel: scores.risk_level,\n    riskReason: scores.risk_reason || 'None',\n    needsImprovement: scores.total_score < 70,\n    improvementAttempts: 0\n  }\n};"},"typeVersion":2},{"id":"ea9f9825-4276-4f12-a417-f06f757360ed","name":"Check if Improvement Needed","type":"n8n-nodes-base.if","position":[-336,-864],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"needs-improvement","operator":{"type":"boolean","operation":"equals"},"leftValue":"={{ $json.needsImprovement }}","rightValue":true},{"id":"improvement-attempts","operator":{"type":"number","operation":"lt"},"leftValue":"={{ $json.improvementAttempts }}","rightValue":"3"}]}},"typeVersion":2},{"id":"74c37691-36e4-4222-b281-f2ea2dd613a1","name":"Auto-Improve Content","type":"n8n-nodes-base.httpRequest","position":[64,-960],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ”¹å–„ã®å°‚é–€å®¶ã§ã™ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ã„ã¦æŠ•ç¨¿ã‚’æ”¹å–„ã—ã¦ãã ã•ã„ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’æ”¹å–„ã—ã¦ãã ã•ã„:\\n\\nå…ƒã®æŠ•ç¨¿:\\n\" + $json.content + \"\\n\\nå“è³ªã‚¹ã‚³ã‚¢: \" + $json.qualityScore + \"/100\\n\\næ”¹å–„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:\\n\" + $json.feedback + \"\\n\\nãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: \" + $json.riskLevel + \"\\n\" + ($json.riskReason !== 'None' ? \"ãƒªã‚¹ã‚¯ç†ç”±: \" + $json.riskReason : '') + \"\\n\\næ”¹å–„ç‰ˆã‚’JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„: {\\\"content\\\": \\\"æ”¹å–„ã•ã‚ŒãŸæŠ•ç¨¿æ–‡\\\", \\\"hashtags\\\": [\\\"ã‚¿ã‚°1\\\", \\\"ã‚¿ã‚°2\\\"]}\"}] }}"},{"name":"temperature","value":"0.7"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"833cc233-23d4-4d79-bc30-4e8f62d4f38c","name":"Parse Improved Content","type":"n8n-nodes-base.code","position":[288,-864],"parameters":{"jsCode":"// Parse improved content\nconst improveResponse = $input.item.json;\nconst improved = JSON.parse(improveResponse.choices[0].message.content);\n\n// Get original data\nconst originalData = $('Parse Quality Scores').item.json;\n\nreturn {\n  json: {\n    content: improved.content,\n    hashtags: improved.hashtags,\n    generatedAt: new Date().toISOString(),\n    platform: originalData.platform,\n    status: 'pending_quality_check',\n    version: originalData.version,\n    improvementAttempts: originalData.improvementAttempts + 1,\n    previousScore: originalData.qualityScore,\n    previousFeedback: originalData.feedback\n  }\n};"},"typeVersion":2},{"id":"07ea81b3-eea8-40b5-93bf-a102bbc9d6b2","name":"Sentiment & Risk Analysis","type":"n8n-nodes-base.httpRequest","position":[64,-784],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯æ—¥æœ¬å¸‚å ´ã«ç‰¹åŒ–ã—ãŸæ„Ÿæƒ…åˆ†æã¨ãƒªã‚¹ã‚¯æ¤œå‡ºã®å°‚é–€å®¶ã§ã™ã€‚ä»¥ä¸‹ã®è¦³ç‚¹ã§åˆ†æã—ã¦ãã ã•ã„:\\n\\nã€ç‚ä¸Šãƒªã‚¹ã‚¯è¦å› ã€‘\\n1. æ”¿æ²»ãƒ»å®—æ•™ã¸ã®è¨€åŠ\\n2. ã‚¸ã‚§ãƒ³ãƒ€ãƒ¼ãƒ»å·®åˆ¥çš„è¡¨ç¾\\n3. ç½å®³ãƒ»äº‹æ•…ã¸ã®ä¸é©åˆ‡ãªè¨€åŠ\\n4. èª‡å¤§åºƒå‘Šãƒ»èª¤è§£ã‚’æ‹›ãè¡¨ç¾\\n5. ç«¶åˆã¸ã®æ”»æ’ƒçš„è¨€åŠ\\n\\nã€æ—¥æœ¬æ–‡åŒ–çš„é…æ…®ã€‘\\n1. ä¸é©åˆ‡ãªæ™‚æœŸã®æŠ•ç¨¿ï¼ˆå–ªä¸­ã€ç½å®³ç›´å¾Œç­‰ï¼‰\\n2. æ•¬èªã®èª¤ç”¨\\n3. æ–‡åŒ–çš„ã‚¿ãƒ–ãƒ¼\\n\\nJSONå½¢å¼ã§è¿”ç­”: {\\\"sentiment\\\": \\\"positive/neutral/negative\\\", \\\"risk_level\\\": \\\"low/medium/high\\\", \\\"risk_factors\\\": [\\\"è¦å› 1\\\", \\\"è¦å› 2\\\"], \\\"recommendations\\\": \\\"æ¨å¥¨äº‹é …\\\", \\\"cultural_appropriateness\\\": \\\"appropriate/needs_review/inappropriate\\\"}\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’åˆ†æã—ã¦ãã ã•ã„:\\n\\n\" + $json.content}] }}"},{"name":"temperature","value":"0.2"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"e31fb9b0-6bf9-4e05-91c3-ffbef666d5e6","name":"Merge Risk Analysis","type":"n8n-nodes-base.code","position":[464,-448],"parameters":{"jsCode":"// Parse sentiment and risk analysis\nconst analysisResponse = $input.item.json;\nconst analysis = JSON.parse(analysisResponse.choices[0].message.content);\n\n// Get content data\nconst contentData = $('Parse Quality Scores').item.json;\n\nreturn {\n  json: {\n    ...contentData,\n    sentiment: analysis.sentiment,\n    riskLevel: analysis.risk_level,\n    riskFactors: analysis.risk_factors,\n    recommendations: analysis.recommendations,\n    culturalAppropriateness: analysis.cultural_appropriateness,\n    finalRiskAssessment: analysis.risk_level === 'high' ? 'auto_reject' : (analysis.risk_level === 'medium' || contentData.qualityScore < 70) ? 'requires_approval' : 'auto_approve'\n  }\n};"},"typeVersion":2},{"id":"451a01cd-63ee-4f36-9363-083d0ee3e6f6","name":"Decision Routing","type":"n8n-nodes-base.if","position":[672,-608],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"auto-approve","operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.finalRiskAssessment }}","rightValue":"auto_approve"}]}},"typeVersion":2},{"id":"ebb2b91a-1574-408a-ab8c-5148c985b575","name":"Save to Notion (Auto-Approved)","type":"n8n-nodes-base.notion","position":[912,-608],"parameters":{"pageId":{"__rl":true,"mode":"url","value":""},"options":{}},"typeVersion":2.1},{"id":"58147eae-9a9d-4a61-9153-611e3e958631","name":"Save to Notion (Pending Approval)","type":"n8n-nodes-base.notion","position":[912,-416],"parameters":{"pageId":{"__rl":true,"mode":"url","value":""},"options":{}},"typeVersion":2.1},{"id":"9013da0d-41b9-422c-91f9-926afbc6c497","name":"Send Approval Email","type":"n8n-nodes-base.emailSend","position":[1232,-416],"webhookId":"77e96129-c787-417b-9c48-cde1bcd684ad","parameters":{"options":{},"subject":"ã€è¦æ‰¿èªã€‘AIã‚³ãƒ³ãƒ†ãƒ³ãƒ„ - å“è³ªã‚¹ã‚³ã‚¢: {{ $json.qualityScore }}ç‚¹ | ãƒªã‚¹ã‚¯: {{ $json.riskLevel }}","toEmail":"user@example.com","fromEmail":"user@example.com"},"typeVersion":2.1},{"id":"4acc6a07-9613-4703-9232-bc3f3858fd8d","name":"Post to Twitter (Auto-Approved)","type":"n8n-nodes-base.httpRequest","position":[1232,-608],"parameters":{"url":"https://api.twitter.com/2/tweets","options":{},"sendBody":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"text","value":"={{ $json.content + ' ' + $json.hashtags.map(tag => '#' + tag).join(' ') }}"}]},"genericAuthType":"oAuth2Api"},"typeVersion":4.1},{"id":"f599a7ef-39fb-46c7-8b1a-bcb7a589702e","name":"Get Japanese Cultural Context","type":"n8n-nodes-base.httpRequest","position":[-1232,-608],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯æ—¥æœ¬ã®å­£ç¯€ãƒ»æ–‡åŒ–ã‚¤ãƒ™ãƒ³ãƒˆã®å°‚é–€å®¶ã§ã™ã€‚ç¾åœ¨ã®æ—¥ä»˜ã«åŸºã¥ã„ã¦ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«åæ˜ ã™ã¹ãæ–‡åŒ–çš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»Šæ—¥ã¯\" + $now.format('yyyyå¹´MMæœˆddæ—¥(ddd)') + \"ã§ã™ã€‚ä»¥ä¸‹ã‚’æ•™ãˆã¦ãã ã•ã„:\\n\\n1. ç¾åœ¨ã®å­£ç¯€ã¨ç‰¹å¾´\\n2. è¿‘æ—¥ä¸­ã®æ—¥æœ¬ã®ç¥æ—¥ãƒ»è¨˜å¿µæ—¥\\n3. ãƒ“ã‚¸ãƒã‚¹ã‚·ãƒ¼ãƒ³ã§æ„è­˜ã™ã¹ãã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ±ºç®—æœŸã€ãƒœãƒ¼ãƒŠã‚¹æ™‚æœŸç­‰ï¼‰\\n4. SNSæŠ•ç¨¿ã§ä½¿ã†ã¹ãå­£ç¯€ã®è¡¨ç¾ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰\\n5. é¿ã‘ã‚‹ã¹ããƒˆãƒ”ãƒƒã‚¯ï¼ˆå–ªä¸­æœŸé–“ã€ç½å®³è¨˜å¿µæ—¥ç­‰ï¼‰\\n\\nJSONå½¢å¼ã§è¿”ç­”ã—ã¦ãã ã•ã„ã€‚\"}] }}"},{"name":"temperature","value":"0.5"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"5f6ec1cb-e46b-4091-9b7c-3eeaa9600128","name":"Get Past 30 Days Posts","type":"n8n-nodes-base.notion","position":[-928,-320],"parameters":{"operation":"getAll"},"typeVersion":2.1},{"id":"7ad8ffaf-34f6-4550-a64f-327a1daa461b","name":"Analyze Brand Voice","type":"n8n-nodes-base.code","position":[-640,-320],"parameters":{"jsCode":"// Analyze past posts to create brand voice profile\nconst posts = $input.all();\n\nif (posts.length === 0) {\n  return {\n    json: {\n      brandVoiceProfile: \"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«: ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã§è¦ªã—ã¿ã‚„ã™ãã€ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³å‘ã‘ã®æœ‰ç›Šãªæƒ…å ±ã‚’æä¾›\",\n      analyzedPosts: 0\n    }\n  };\n}\n\nconst contents = posts.map(p => p.json.Content || p.json.content).filter(c => c);\n\nconst analysisData = {\n  totalPosts: contents.length,\n  averageLength: Math.round(contents.reduce((sum, c) => sum + c.length, 0) / contents.length),\n  hashtagUsage: posts.flatMap(p => p.json.Hashtags || p.json.hashtags || []),\n  emojiCount: contents.reduce((sum, c) => sum + (c.match(/[\\u{1F300}-\\u{1F9FF}]/gu) || []).length, 0),\n  questionPosts: contents.filter(c => c.includes('?') || c.includes('?')).length\n};\n\nreturn {\n  json: {\n    brandVoiceAnalysis: analysisData,\n    analyzedPosts: contents.length,\n    topHashtags: [...new Set(analysisData.hashtagUsage)].slice(0, 10)\n  }\n};"},"typeVersion":2},{"id":"d437b5ec-fb0e-46e1-badb-bf1f7a5bf22b","name":"Create Brand Voice Profile","type":"n8n-nodes-base.httpRequest","position":[-368,-320],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"éå»ã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ãƒ–ãƒ©ãƒ³ãƒ‰ãƒœã‚¤ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã€ãƒ–ãƒ©ãƒ³ãƒ‰ãƒœã‚¤ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„:\\n\\nåˆ†ææŠ•ç¨¿æ•°: \" + $json.analyzedPosts + \"\\nå¹³å‡æ–‡å­—æ•°: \" + $json.brandVoiceAnalysis.averageLength + \"\\nçµµæ–‡å­—ä½¿ç”¨æ•°: \" + $json.brandVoiceAnalysis.emojiCount + \"\\nè³ªå•å½¢å¼æŠ•ç¨¿: \" + $json.brandVoiceAnalysis.questionPosts + \"\\nã‚ˆãä½¿ã†ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: \" + $json.topHashtags.join(', ') + \"\\n\\nJSONå½¢å¼ã§ä»¥ä¸‹ã‚’è¿”ã—ã¦ãã ã•ã„:\\n{\\\"tone\\\": \\\"æ–‡ä½“ã®ç‰¹å¾´\\\", \\\"emoji_usage\\\": \\\"çµµæ–‡å­—ä½¿ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³\\\", \\\"average_length\\\": \\\"æ¨å¥¨æ–‡å­—æ•°\\\", \\\"key_phrases\\\": [\\\"ã‚ˆãä½¿ã†ãƒ•ãƒ¬ãƒ¼ã‚º\\\"], \\\"cta_style\\\": \\\"CTA(è¡Œå‹•å–šèµ·)ã®ã‚¹ã‚¿ã‚¤ãƒ«\\\"}\"}] }}"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"8fdc27ce-4ee6-4b4e-9a06-38db4f5b6d7f","name":"Webhook - Approval Dashboard","type":"n8n-nodes-base.webhook","position":[-1456,128],"webhookId":"approval-webhook","parameters":{"path":"approval-webhook","options":{}},"typeVersion":1.1},{"id":"b5e26e78-ec91-4c1f-b892-fa3c15b2d4ed","name":"Process Approval Action","type":"n8n-nodes-base.code","position":[-1248,128],"parameters":{"jsCode":"// Handle approval webhook\nconst action = $input.item.json.query.action; // approve, reject, edit\nconst contentId = $input.item.json.query.id;\nconst editedContent = $input.item.json.body?.editedContent;\n\nreturn {\n  json: {\n    action: action,\n    contentId: contentId,\n    editedContent: editedContent,\n    approvedBy: $input.item.json.body?.approvedBy || 'Unknown',\n    timestamp: new Date().toISOString()\n  }\n};"},"typeVersion":2},{"id":"0b302fff-97a9-48ba-9123-decbb8d3b370","name":"Check Approval Action","type":"n8n-nodes-base.if","position":[-1008,128],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"is-approved","operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.action }}","rightValue":"approve"}]}},"typeVersion":2},{"id":"90bb9902-6237-4b2d-b132-d26515ca1921","name":"Update Notion - Approved","type":"n8n-nodes-base.notion","position":[-784,32],"parameters":{"operation":"update"},"typeVersion":2.1},{"id":"b2c8f814-39e4-4233-b35f-b65f0dcc1429","name":"Update Notion - Rejected","type":"n8n-nodes-base.notion","position":[-784,224],"parameters":{"operation":"update"},"typeVersion":2.1},{"id":"ba5bc1a8-dbd9-49b5-add9-a7bf257c6622","name":"Weekly Performance Report Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[-1456,720],"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 10 * * 1"}]}},"typeVersion":1.1},{"id":"c45a573c-7956-4c4f-8fbe-372e8d0fba17","name":"Get Past Week Posts","type":"n8n-nodes-base.notion","position":[-1248,720],"parameters":{"operation":"getAll"},"typeVersion":2.1},{"id":"ae72df4a-5b2f-41bd-a58e-decaa7d0429c","name":"Generate Weekly Analytics Report","type":"n8n-nodes-base.httpRequest","position":[-1008,720],"parameters":{"url":"https://api.openai.com/v1/chat/completions","options":{},"sendBody":true,"sendHeaders":true,"authentication":"genericCredentialType","bodyParameters":{"parameters":[{"name":"model","value":"gpt-4"},{"name":"messages","value":"={{ [{\"role\": \"system\", \"content\": \"ã‚ãªãŸã¯ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚éå»1é€±é–“ã®ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åˆ†æã—ã€æ”¹å–„ææ¡ˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\"}, {\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ãã ã•ã„:\\n\\n\" + JSON.stringify($input.all().map(item => ({content: item.json.Content, qualityScore: item.json['Quality Score'], engagement: item.json.Engagement || 0, platform: item.json.Platform}))) + \"\\n\\nä»¥ä¸‹ã®å½¢å¼ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„:\\n1. ç·åˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚µãƒãƒªãƒ¼\\n2. ãƒ™ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŠ•ç¨¿ï¼ˆTOP3ï¼‰\\n3. æ”¹å–„ãŒå¿…è¦ãªæŠ•ç¨¿\\n4. ç™ºè¦‹ã•ã‚ŒãŸãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³\\n5. æ¬¡é€±ã¸ã®å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ\\n\\nMarkdownå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚\"}] }}"},{"name":"temperature","value":"0.7"}]},"genericAuthType":"httpHeaderAuth","headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]}},"typeVersion":4.1},{"id":"b8903692-a75a-40d4-8bd1-d07cacf51efc","name":"Send Weekly Report Email","type":"n8n-nodes-base.emailSend","position":[-784,720],"webhookId":"006ff7d7-8f9e-433c-a4db-824abad52bf2","parameters":{"options":{},"subject":"ğŸ“Š é€±æ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ - {{ $now.format('yyyyå¹´MMæœˆddæ—¥') }}","toEmail":"user@example.com","fromEmail":"user@example.com"},"typeVersion":2.1},{"id":"e4135011-c917-41db-90c7-7904781cc800","name":"Sticky Note - Main Overview","type":"n8n-nodes-base.stickyNote","position":[-2176,-1136],"parameters":{"width":560,"height":2164,"content":"## AI-Powered Japanese Social Media Content Generator with Quality Control\n\n### ğŸ¯ Who's it for\n\nMarketing teams and social media managers in Japan who want to automate content creation while maintaining high quality standards and cultural appropriateness. Perfect for businesses that need consistent Japanese-language social media presence with built-in compliance checks.\n\n### ğŸ“ What it does\n\nThis workflow creates an intelligent content generation system that:\n\n- Generates culturally-aware Japanese Twitter posts using GPT-4\n- Automatically scores content quality across 5 dimensions (engagement, SEO, brand voice, readability, CTA)\n- Performs sentiment analysis and risk detection for controversial topics\n- Routes content intelligently: auto-posts high-quality/low-risk content, flags medium-risk content for approval, and rejects high-risk content\n- Includes an auto-improvement loop that refines content up to 3 times if quality scores are below 70\n- Provides weekly performance analytics and recommendations\n\n### ğŸ”§ How it works\n\n**Daily Content Generation Flow:**\n1. Schedule trigger runs weekday mornings at 9 AM\n2. Fetches Japanese cultural context (seasons, holidays, business events)\n3. Analyzes brand voice from past 30 days of posts\n4. Generates 3 Twitter post variations with GPT-4\n5. Each post is scored on quality metrics (100-point scale)\n6. Low-scoring content enters auto-improvement loop\n7. Risk analysis checks for controversy, cultural sensitivity, and sentiment\n8. Decision routing: auto-approve and post OR send for manual approval OR reject\n\n**Approval Workflow:**\n- Pending posts trigger approval emails\n- Webhook receives approval/rejection/edit actions\n- Approved posts are published to Twitter and archived in Notion\n\n**Weekly Analytics:**\n- Monday morning trigger analyzes past week's performance\n- GPT-4 generates insights report with best practices\n- Email sent to team with recommendations\n\n### âš™ï¸ Requirements\n\n**APIs & Credentials:**\n- OpenAI API (GPT-4 access)\n- Twitter API v2 with OAuth 2.0\n- Notion API (database for content storage)\n- Email sending service (SMTP or SendGrid)\n\n**Setup:**\n1. Create a Notion database with columns: Content, Hashtags, Quality Score, Risk Level, Status, Engagement\n2. Configure OpenAI API credentials with HTTP Header Auth\n3. Set up Twitter OAuth 2.0 credentials\n4. Configure email service for approval notifications\n\n### ğŸ¨ How to customize\n\n**Adjust Quality Thresholds:**\n- Modify the quality scoring criteria in \"AI Quality Scoring\" node\n- Change auto-approval threshold (currently 70+ points)\n\n**Content Generation:**\n- Edit GPT-4 prompts in \"Generate Content with GPT-4\" node to match your brand tone\n- Adjust temperature settings for more/less creative content\n- Modify the number of posts generated per run\n\n**Risk Detection:**\n- Customize risk factors in \"Sentiment & Risk Analysis\" node\n- Add industry-specific compliance checks\n\n**Brand Voice Learning:**\n- Adjust the lookback period in \"Get Past 30 Days Posts\" (currently 30 days)\n- Modify brand voice analysis logic in \"Analyze Brand Voice\" node\n\n**Scheduling:**\n- Change cron expressions for daily content generation and weekly reports\n- Add additional triggers for special campaigns\n\n### âš ï¸ Important Notes\n\n- This workflow uses Japanese language prompts - modify system prompts if using for other languages\n- Ensure compliance with Twitter's API rate limits and automation policies\n- Review auto-posted content regularly to validate AI quality assessments\n- The workflow stores all generated content in Notion for audit trails"},"typeVersion":1}],"pinData":{},"connections":{"Decision Routing":{"main":[[{"node":"Save to Notion (Auto-Approved)","type":"main","index":0}],[{"node":"Save to Notion (Pending Approval)","type":"main","index":0}]]},"AI Quality Scoring":{"main":[[{"node":"Parse Quality Scores","type":"main","index":0}]]},"Analyze Brand Voice":{"main":[[{"node":"Create Brand Voice Profile","type":"main","index":0}]]},"Get Past Week Posts":{"main":[[{"node":"Generate Weekly Analytics Report","type":"main","index":0}]]},"Merge Risk Analysis":{"main":[[{"node":"Decision Routing","type":"main","index":0}]]},"Auto-Improve Content":{"main":[[{"node":"Parse Improved Content","type":"main","index":0}]]},"Parse Quality Scores":{"main":[[{"node":"Check if Improvement Needed","type":"main","index":0}]]},"Check Approval Action":{"main":[[{"node":"Update Notion - Approved","type":"main","index":0}],[{"node":"Update Notion - Rejected","type":"main","index":0}]]},"Get Past 30 Days Posts":{"main":[[{"node":"Analyze Brand Voice","type":"main","index":0}]]},"Parse Improved Content":{"main":[[{"node":"AI Quality Scoring","type":"main","index":0}]]},"Parse Generated Content":{"main":[[{"node":"AI Quality Scoring","type":"main","index":0}]]},"Process Approval Action":{"main":[[{"node":"Check Approval Action","type":"main","index":0}]]},"Sentiment & Risk Analysis":{"main":[[{"node":"Merge Risk Analysis","type":"main","index":0}]]},"Check if Improvement Needed":{"main":[[{"node":"Auto-Improve Content","type":"main","index":0}],[{"node":"Sentiment & Risk Analysis","type":"main","index":0}]]},"Generate Content with GPT-4":{"main":[[{"node":"Parse Generated Content","type":"main","index":0}]]},"Webhook - Approval Dashboard":{"main":[[{"node":"Process Approval Action","type":"main","index":0}]]},"Save to Notion (Auto-Approved)":{"main":[[{"node":"Post to Twitter (Auto-Approved)","type":"main","index":0}]]},"Generate Weekly Analytics Report":{"main":[[{"node":"Send Weekly Report Email","type":"main","index":0}]]},"Save to Notion (Pending Approval)":{"main":[[{"node":"Send Approval Email","type":"main","index":0}]]},"Schedule Daily Content Generation":{"main":[[{"node":"Generate Content with GPT-4","type":"main","index":0},{"node":"Get Japanese Cultural Context","type":"main","index":0},{"node":"Get Past 30 Days Posts","type":"main","index":0}]]},"Weekly Performance Report Trigger":{"main":[[{"node":"Get Past Week Posts","type":"main","index":0}]]}}}