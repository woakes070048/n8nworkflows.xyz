{"meta":{"instanceId":"688a68e73a120913da7192565b7c4d86fa09171a2ffb938e36ffac33fa674c56","templateCredsSetupCompleted":true},"nodes":[{"id":"492a80ad-8f83-4b7a-a014-d825d097e396","name":"Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","position":[-12672,-784],"parameters":{"filters":{"q":"newer_than:1d -from:me","labelIds":["INBOX"]},"pollTimes":{"item":[{"mode":"everyMinute"}]}},"typeVersion":1},{"id":"43e17396-64a8-403c-8ea2-7fc5d11c0f81","name":"Webhook - Web Form","type":"n8n-nodes-base.webhook","position":[-12672,-592],"webhookId":"YOUR_WEBHOOK_ID","parameters":{"path":"ai-sales-agent","options":{},"httpMethod":"POST"},"typeVersion":2},{"id":"b4f808e3-ba0e-4c54-8e10-d68877d5798b","name":"Webhook - WhatsApp/Telegram","type":"n8n-nodes-base.webhook","position":[-12672,-384],"webhookId":"YOUR_WEBHOOK_ID","parameters":{"path":"ai-sales-chat","options":{},"httpMethod":"POST"},"typeVersion":2},{"id":"e2918869-b14e-440d-85c7-3d16bd958a3b","name":"Auto Nurturing Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[-12672,416],"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 10 * * *"}]}},"typeVersion":1.1},{"id":"a5274a05-57c3-46b6-825e-4970b339ed72","name":"Weekly Report Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[-12672,848],"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 9 * * 1"}]}},"typeVersion":1.1},{"id":"77032e20-9603-40a5-9c49-1ab82778654d","name":"Normalize Input","type":"n8n-nodes-base.code","position":[-12368,-592],"parameters":{"jsCode":"// Normalize data from multiple sources to unified format\nconst input = $input.item.json;\nconst source = $input.item.json.body ? 'webhook' : 'gmail';\n\nlet lead = {\n  source: source,\n  channel: 'unknown',\n  email: '',\n  name: '',\n  phone: '',\n  company: '',\n  message: '',\n  subject: '',\n  messageId: '',\n  threadId: '',\n  timestamp: new Date().toISOString()\n};\n\nif (source === 'gmail') {\n  const fromField = input.from || input.From || '';\n  const match = fromField.match(/(.*?)\\s*<(.+?)>/);\n  \n  lead.channel = 'email';\n  lead.email = match ? match[2].trim() : fromField.trim();\n  lead.name = match ? match[1].trim() : lead.email.split('@')[0];\n  lead.subject = input.subject || input.Subject || '';\n  lead.message = input.textPlain || input.snippet || '';\n  lead.messageId = input.id || '';\n  lead.threadId = input.threadId || '';\n} else {\n  const body = input.body || input;\n  \n  lead.channel = body.channel || 'web_form';\n  lead.email = body.email || '';\n  lead.name = body.name || '';\n  lead.phone = body.phone || '';\n  lead.company = body.company || '';\n  lead.message = body.message || '';\n  lead.subject = body.subject || 'Inquiry from ' + lead.channel;\n}\n\nconst emailLower = lead.email.toLowerCase();\nconst isNotification = \n  emailLower.includes('noreply') ||\n  emailLower.includes('no-reply') ||\n  emailLower.includes('mailer-daemon') ||\n  emailLower.includes('calendly.com') ||\n  emailLower.includes('notifications');\n\nlead.isNotification = isNotification;\nlead.leadId = `LEAD-${Date.now()}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;\n\nreturn { json: lead };"},"typeVersion":2},{"id":"5682016f-254b-4327-b117-a8a343e6cb29","name":"Is Valid Lead?","type":"n8n-nodes-base.if","position":[-12128,-592],"parameters":{"conditions":{"boolean":[{"value1":"={{ $json.isNotification }}"}]}},"typeVersion":1},{"id":"a9879846-c77d-4b52-bd53-47249838dcd8","name":"Find Existing Lead","type":"n8n-nodes-base.googleSheets","position":[-11888,-688],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":"Leads"},"documentId":{"__rl":true,"mode":"id","value":"YOUR_DOCUMENT_ID"}},"typeVersion":4},{"id":"1e9ecf43-3608-4a3f-9ed4-7539b06b0eff","name":"Check History","type":"n8n-nodes-base.code","position":[-11648,-688],"parameters":{"jsCode":"const currentLead = $('Normalize Input').first().json;\nconst existingLeads = $input.all().map(i => i.json);\n\nconst existingLead = existingLeads.find(l => \n  l.email?.toLowerCase() === currentLead.email.toLowerCase()\n);\n\nlet history = [];\nlet interactions = 0;\nlet currentScore = 0;\nlet currentStage = 'new';\nlet lastInteraction = null;\n\nif (existingLead) {\n  interactions = parseInt(existingLead.interactions || '0') + 1;\n  currentScore = parseInt(existingLead.score || '0');\n  currentStage = existingLead.stage || 'contacted';\n  lastInteraction = existingLead.last_interaction;\n  \n  try {\n    history = JSON.parse(existingLead.history || '[]');\n  } catch (e) {\n    history = [];\n  }\n}\n\nhistory.push({\n  date: currentLead.timestamp,\n  channel: currentLead.channel,\n  subject: currentLead.subject,\n  summary: currentLead.message.substring(0, 100)\n});\n\nif (history.length > 10) history = history.slice(-10);\n\nreturn {\n  json: {\n    ...currentLead,\n    isNew: !existingLead,\n    interactions: interactions,\n    currentScore: currentScore,\n    currentStage: currentStage,\n    lastInteraction: lastInteraction,\n    history: history,\n    historyJSON: JSON.stringify(history)\n  }\n};"},"typeVersion":2},{"id":"04e6e6e8-e8b2-430b-b1b8-cea463edae31","name":"AI Analysis Engine","type":"@n8n/n8n-nodes-langchain.openAi","position":[-11408,-688],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"maxTokens":1000,"temperature":0.3},"messages":{"values":[{"role":"system","content":"You are an expert B2B lead analyst. Your job is to analyze messages from potential customers and extract structured information.\n\nYou MUST respond ONLY with valid JSON, no additional text, with this exact structure:\n{\n  \"sentiment\": \"positive|neutral|negative\",\n  \"urgency\": \"high|medium|low\",\n  \"intent\": \"purchase|information|support|partnership|other\",\n  \"budget_signals\": \"high|medium|low|unknown\",\n  \"decision_maker\": true|false,\n  \"pain_points\": [\"list\", \"of\", \"problems\"],\n  \"interests\": [\"list\", \"of\", \"interests\"],\n  \"next_action\": \"schedule_demo|send_info|call|nurturing|disqualify\",\n  \"lead_temperature\": \"hot|warm|cold\",\n  \"summary\": \"1-line summary of the lead\"\n}"},{"content":"=LEAD INFO:\nName: {{ $json.name }}\nCompany: {{ $json.company || 'Not specified' }}\nChannel: {{ $json.channel }}\nPrevious interactions: {{ $json.interactions }}\nCurrent stage: {{ $json.currentStage }}\n\nMESSAGE:\nSubject: {{ $json.subject }}\n{{ $json.message }}\n\nRECENT HISTORY:\n{{ $json.historyJSON }}"}]}},"typeVersion":1},{"id":"6c82292c-b2b1-4d4a-9c5f-5f0391f9bae5","name":"Calculate Lead Score","type":"n8n-nodes-base.code","position":[-11168,-688],"parameters":{"jsCode":"const leadData = $('Check History').first().json;\nconst aiResponseRaw = $json.message?.content || $json.content || '{}';\n\nlet aiAnalysis;\ntry {\n  const cleanJson = aiResponseRaw.replace(/```json\\n?|```\\n?/g, '').trim();\n  aiAnalysis = JSON.parse(cleanJson);\n} catch (e) {\n  aiAnalysis = {\n    sentiment: 'neutral',\n    urgency: 'medium',\n    intent: 'information',\n    budget_signals: 'unknown',\n    decision_maker: false,\n    pain_points: [],\n    interests: [],\n    next_action: 'nurturing',\n    lead_temperature: 'warm',\n    summary: 'Analysis pending'\n  };\n}\n\nlet score = leadData.currentScore || 0;\n\n// Channel scoring\nconst channelScores = {\n  'email': 10,\n  'web_form': 15,\n  'whatsapp': 20,\n  'telegram': 15,\n  'linkedin': 25,\n  'referral': 30\n};\nscore += channelScores[leadData.channel] || 5;\n\n// Sentiment scoring\nif (aiAnalysis.sentiment === 'positive') score += 15;\nelse if (aiAnalysis.sentiment === 'negative') score -= 10;\n\n// Urgency scoring\nif (aiAnalysis.urgency === 'high') score += 25;\nelse if (aiAnalysis.urgency === 'medium') score += 10;\n\n// Intent scoring\nconst intentScores = {\n  'purchase': 30,\n  'partnership': 25,\n  'information': 10,\n  'support': 5,\n  'other': 0\n};\nscore += intentScores[aiAnalysis.intent] || 0;\n\n// Budget scoring\nif (aiAnalysis.budget_signals === 'high') score += 20;\nelse if (aiAnalysis.budget_signals === 'medium') score += 10;\n\n// Decision maker bonus\nif (aiAnalysis.decision_maker) score += 20;\n\n// Interaction bonus (max 25)\nscore += Math.min(leadData.interactions * 5, 25);\n\n// Temperature bonus\nif (aiAnalysis.lead_temperature === 'hot') score += 15;\nelse if (aiAnalysis.lead_temperature === 'warm') score += 5;\n\n// Clamp score 0-100\nscore = Math.max(0, Math.min(100, score));\n\n// Determine stage\nlet stage = 'new';\nif (score >= 80) stage = 'opportunity';\nelse if (score >= 60) stage = 'qualified';\nelse if (score >= 40) stage = 'interested';\nelse if (score >= 20) stage = 'contacted';\n\n// Determine priority\nlet priority = 'low';\nif (score >= 70 || aiAnalysis.urgency === 'high') priority = 'high';\nelse if (score >= 40) priority = 'medium';\n\nlet nextAction = aiAnalysis.next_action;\nlet autoReply = true;\n\nconst notifySales = score >= 70 || aiAnalysis.lead_temperature === 'hot';\n\nreturn {\n  json: {\n    ...leadData,\n    aiAnalysis: aiAnalysis,\n    sentiment: aiAnalysis.sentiment,\n    urgency: aiAnalysis.urgency,\n    intent: aiAnalysis.intent,\n    budgetSignals: aiAnalysis.budget_signals,\n    isDecisionMaker: aiAnalysis.decision_maker,\n    painPoints: aiAnalysis.pain_points.join(', '),\n    interests: aiAnalysis.interests.join(', '),\n    leadTemperature: aiAnalysis.lead_temperature,\n    aiSummary: aiAnalysis.summary,\n    score: score,\n    scoreLabel: score >= 80 ? 'Hot' : score >= 60 ? 'Warm' : score >= 40 ? 'Cool' : 'Cold',\n    stage: stage,\n    priority: priority,\n    nextAction: nextAction,\n    autoReply: autoReply,\n    notifySales: notifySales\n  }\n};"},"typeVersion":2},{"id":"ac018fe3-b208-4d56-ae6d-2fd5860c46f5","name":"Action Router","type":"n8n-nodes-base.switch","position":[-10928,-688],"parameters":{"rules":{"rules":[{"value2":"schedule_demo"},{"value2":"send_info"},{"value2":"call"},{"value2":"nurturing"},{"value2":"disqualify"}]},"value1":"={{ $json.nextAction }}","dataType":"string"},"typeVersion":2},{"id":"2ce89cfe-d860-4804-8bd1-82bda699b18c","name":"Generate Response - Demo","type":"@n8n/n8n-nodes-langchain.openAi","position":[-10672,-816],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"maxTokens":500,"temperature":0.7},"messages":{"values":[{"role":"system","content":"You are an expert and friendly SDR (Sales Development Rep) for a software company.\n\nCOMPANY: [Your Company]\nPRODUCT: [Your Product/Service]\nCALENDLY: https://calendly.com/your-user/demo\n\nGOAL: Schedule a personalized demo.\n\nSTYLE:\n- Professional but approachable\n- Specifically mention how you can help with their pain points\n- Include clear CTA to schedule\n- Maximum 3 short paragraphs\n\nResponse ONLY in plain text, no HTML or markdown."},{"content":"=LEAD CONTEXT:\nName: {{ $('Calculate Lead Score').item.json.name }}\nCompany: {{ $('Calculate Lead Score').item.json.company || 'Not specified' }}\nTemperature: {{ $('Calculate Lead Score').item.json.leadTemperature }}\nPain Points: {{ $('Calculate Lead Score').item.json.painPoints }}\nInterests: {{ $('Calculate Lead Score').item.json.interests }}\n\nTHEIR MESSAGE:\n{{ $('Calculate Lead Score').item.json.message }}\n\nGenerate a response to schedule a demo."}]}},"typeVersion":1},{"id":"cb0a8c24-f241-4500-96a8-a31474bb076b","name":"Generate Response - Info","type":"@n8n/n8n-nodes-langchain.openAi","position":[-10672,-608],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"maxTokens":500,"temperature":0.7},"messages":{"values":[{"role":"system","content":"You are a friendly and expert sales representative.\n\nCOMPANY: [Your Company]\nPRODUCT: [Your Product/Service]\n\nGOAL: Provide useful information and move toward demo.\n\nSTYLE:\n- Answer their specific questions\n- Mention benefits relevant to their interests\n- Gently suggest a call/demo\n- Maximum 3 paragraphs\n\nResponse ONLY in plain text."},{"content":"=CONTEXT:\nName: {{ $('Calculate Lead Score').item.json.name }}\nInterests: {{ $('Calculate Lead Score').item.json.interests }}\nPain Points: {{ $('Calculate Lead Score').item.json.painPoints }}\n\nTHEIR MESSAGE:\n{{ $('Calculate Lead Score').item.json.message }}\n\nGenerate informative response."}]}},"typeVersion":1},{"id":"56f6b3ff-1060-4ed8-be6f-b4301960c340","name":"Generate Response - Nurturing","type":"@n8n/n8n-nodes-langchain.openAi","position":[-10672,-416],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"maxTokens":400,"temperature":0.7},"messages":{"values":[{"role":"system","content":"You are a friendly advisor.\n\nGOAL: Maintain the relationship without being pushy.\n\nSTYLE:\n- Thank them for reaching out\n- Offer value (resource, tip, etc)\n- Leave door open\n- Short and friendly\n\nResponse ONLY in plain text, maximum 2 paragraphs."},{"content":"=Name: {{ $('Calculate Lead Score').item.json.name }}\nMessage: {{ $('Calculate Lead Score').item.json.message }}\n\nGenerate nurturing response."}]}},"typeVersion":1},{"id":"f76b606d-4fe4-40b0-a90c-ffa3efaabc29","name":"Prepare Email - Demo","type":"n8n-nodes-base.code","position":[-10432,-816],"parameters":{"jsCode":"const lead = $('Calculate Lead Score').first().json;\nconst aiResponse = $json.message?.content || $json.content || '';\n\n// CONFIG - Edit these values\nconst CONFIG = {\n  companyName: 'Your Company',\n  primaryColor: '#6366f1',\n  secondaryColor: '#8b5cf6',\n  calendlyLink: 'https://calendly.com/your-user/demo'\n};\n\nconst subject = lead.subject.startsWith('Re:') ? lead.subject : `Re: ${lead.subject}`;\n\nconst emailHtml = `\n<!DOCTYPE html>\n<html><head><meta charset=\"UTF-8\"></head>\n<body style=\"margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;background:#f4f7fa;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f4f7fa;padding:40px 20px;\">\n    <tr><td align=\"center\">\n      <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;\">\n        <tr><td style=\"background:linear-gradient(135deg, ${CONFIG.primaryColor}, ${CONFIG.secondaryColor});padding:35px;text-align:center;\">\n          <h1 style=\"margin:0;color:#fff;font-size:26px;\">${CONFIG.companyName}</h1>\n        </td></tr>\n        <tr><td style=\"padding:35px;\">\n          <h2 style=\"margin:0 0 20px;color:#1e293b;\">Hi ${lead.name}!</h2>\n          <p style=\"color:#475569;font-size:16px;line-height:1.8;white-space:pre-line;\">${aiResponse}</p>\n          \n          <div style=\"text-align:center;margin:35px 0;\">\n            <a href=\"${CONFIG.calendlyLink}\" style=\"display:inline-block;background:linear-gradient(135deg, ${CONFIG.primaryColor}, ${CONFIG.secondaryColor});color:#fff;text-decoration:none;padding:18px 50px;border-radius:12px;font-size:17px;font-weight:600;box-shadow:0 4px 15px ${CONFIG.primaryColor}50;\">\n              Schedule Personalized Demo\n            </a>\n          </div>\n          \n          <div style=\"background:#f8fafc;border-radius:12px;padding:20px;margin-top:25px;border-left:4px solid ${CONFIG.primaryColor};\">\n            <p style=\"margin:0;color:#64748b;font-size:14px;\"><strong>Tip:</strong> The demo takes only 20 minutes and is designed specifically to show you how to solve your needs.</p>\n          </div>\n        </td></tr>\n        <tr><td style=\"background:#f8fafc;padding:25px;text-align:center;border-top:1px solid #e2e8f0;\">\n          <p style=\"margin:0;color:#94a3b8;font-size:12px;\">${new Date().getFullYear()} ${CONFIG.companyName}</p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n</body>\n</html>`;\n\nreturn {\n  json: {\n    ...lead,\n    to: lead.email,\n    subject: subject,\n    htmlContent: emailHtml,\n    aiResponse: aiResponse,\n    responseType: 'demo'\n  }\n};"},"typeVersion":2},{"id":"d7b63b38-7883-4369-8a09-328dc2665928","name":"Prepare Email - Info","type":"n8n-nodes-base.code","position":[-10432,-608],"parameters":{"jsCode":"const lead = $('Calculate Lead Score').first().json;\nconst aiResponse = $json.message?.content || $json.content || '';\n\nconst CONFIG = {\n  companyName: 'Your Company',\n  primaryColor: '#0ea5e9',\n  calendlyLink: 'https://calendly.com/your-user/30min'\n};\n\nconst subject = lead.subject.startsWith('Re:') ? lead.subject : `Re: ${lead.subject}`;\n\nconst emailHtml = `\n<!DOCTYPE html>\n<html><head><meta charset=\"UTF-8\"></head>\n<body style=\"margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;background:#f4f7fa;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f4f7fa;padding:40px 20px;\">\n    <tr><td align=\"center\">\n      <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;\">\n        <tr><td style=\"background:${CONFIG.primaryColor};padding:35px;text-align:center;\">\n          <h1 style=\"margin:0;color:#fff;font-size:26px;\">${CONFIG.companyName}</h1>\n        </td></tr>\n        <tr><td style=\"padding:35px;\">\n          <h2 style=\"margin:0 0 20px;color:#1e293b;\">Hi ${lead.name}!</h2>\n          <p style=\"color:#475569;font-size:16px;line-height:1.8;white-space:pre-line;\">${aiResponse}</p>\n          \n          <div style=\"text-align:center;margin:30px 0;\">\n            <a href=\"${CONFIG.calendlyLink}\" style=\"display:inline-block;background:${CONFIG.primaryColor};color:#fff;text-decoration:none;padding:16px 40px;border-radius:10px;font-size:16px;font-weight:600;\">Let's Talk?</a>\n          </div>\n        </td></tr>\n        <tr><td style=\"background:#f8fafc;padding:25px;text-align:center;border-top:1px solid #e2e8f0;\">\n          <p style=\"margin:0;color:#94a3b8;font-size:12px;\">${new Date().getFullYear()} ${CONFIG.companyName}</p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n</body>\n</html>`;\n\nreturn {\n  json: {\n    ...lead,\n    to: lead.email,\n    subject: subject,\n    htmlContent: emailHtml,\n    aiResponse: aiResponse,\n    responseType: 'info'\n  }\n};"},"typeVersion":2},{"id":"5ff8afb9-4432-44c8-b232-c9d6ed99d03c","name":"Prepare Email - Nurturing","type":"n8n-nodes-base.code","position":[-10432,-416],"parameters":{"jsCode":"const lead = $('Calculate Lead Score').first().json;\nconst aiResponse = $json.message?.content || $json.content || '';\n\nconst CONFIG = {\n  companyName: 'Your Company',\n  primaryColor: '#10b981'\n};\n\nconst subject = lead.subject.startsWith('Re:') ? lead.subject : `Re: ${lead.subject}`;\n\nconst emailHtml = `\n<!DOCTYPE html>\n<html><head><meta charset=\"UTF-8\"></head>\n<body style=\"margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;background:#f4f7fa;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f4f7fa;padding:40px 20px;\">\n    <tr><td align=\"center\">\n      <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;\">\n        <tr><td style=\"background:${CONFIG.primaryColor};padding:30px;text-align:center;\">\n          <h1 style=\"margin:0;color:#fff;font-size:24px;\">${CONFIG.companyName}</h1>\n        </td></tr>\n        <tr><td style=\"padding:35px;\">\n          <h2 style=\"margin:0 0 20px;color:#1e293b;\">Hi ${lead.name}!</h2>\n          <p style=\"color:#475569;font-size:16px;line-height:1.8;white-space:pre-line;\">${aiResponse}</p>\n        </td></tr>\n        <tr><td style=\"background:#f8fafc;padding:25px;text-align:center;border-top:1px solid #e2e8f0;\">\n          <p style=\"margin:0;color:#94a3b8;font-size:12px;\">${new Date().getFullYear()} ${CONFIG.companyName}</p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n</body>\n</html>`;\n\nreturn {\n  json: {\n    ...lead,\n    to: lead.email,\n    subject: subject,\n    htmlContent: emailHtml,\n    aiResponse: aiResponse,\n    responseType: 'nurturing'\n  }\n};"},"typeVersion":2},{"id":"549b239c-ec69-41ff-ba7e-6156f7c51ae7","name":"Send Email","type":"n8n-nodes-base.gmail","onError":"continueErrorOutput","position":[-10048,-752],"webhookId":"345abaee-f628-4b8c-800f-e84d04d12aab","parameters":{"sendTo":"={{ $json.to }}","message":"={{ $json.htmlContent }}","options":{"appendAttribution":false},"subject":"={{ $json.subject }}"},"typeVersion":2},{"id":"127d9cdd-0f27-4f03-9123-cbca4f8e44b7","name":"Save/Update Lead","type":"n8n-nodes-base.code","position":[-9808,-752],"parameters":{"jsCode":"const lead = $json;\n\nreturn {\n  json: {\n    lead_id: lead.leadId,\n    email: lead.email,\n    name: lead.name,\n    company: lead.company || '',\n    phone: lead.phone || '',\n    score: lead.score,\n    score_label: lead.scoreLabel,\n    stage: lead.stage,\n    priority: lead.priority,\n    temperature: lead.leadTemperature,\n    sentiment: lead.sentiment,\n    intent: lead.intent,\n    urgency: lead.urgency,\n    budget_signals: lead.budgetSignals,\n    is_decision_maker: lead.isDecisionMaker ? 'Yes' : 'No',\n    pain_points: lead.painPoints,\n    interests: lead.interests,\n    ai_summary: lead.aiSummary,\n    source_channel: lead.channel,\n    interactions: lead.interactions + 1,\n    last_interaction: new Date().toISOString(),\n    response_type: lead.responseType,\n    history: lead.historyJSON,\n    is_new: lead.isNew ? 'Yes' : 'No',\n    last_subject: lead.subject,\n    last_message: lead.message.substring(0, 500),\n    response_sent: lead.aiResponse?.substring(0, 500) || ''\n  }\n};"},"typeVersion":2},{"id":"b730d5e5-c9f2-41ae-9d9b-d2320734c2ac","name":"Sheet - New Lead","type":"n8n-nodes-base.googleSheets","position":[-9552,-864],"parameters":{"columns":{"value":{},"mappingMode":"autoMapInputData"},"options":{},"operation":"append","sheetName":{"__rl":true,"mode":"list","value":"Leads"},"documentId":{"__rl":true,"mode":"id","value":"YOUR_DOCUMENT_ID"}},"typeVersion":4},{"id":"6c1efcf1-0d74-47a2-ba0f-4ebffb11244c","name":"Sheet - Update Lead","type":"n8n-nodes-base.googleSheets","position":[-9552,-656],"parameters":{"columns":{"value":{},"mappingMode":"autoMapInputData"},"options":{},"operation":"update","sheetName":{"__rl":true,"mode":"list","value":"Leads"},"documentId":{"__rl":true,"mode":"id","value":"YOUR_DOCUMENT_ID"}},"typeVersion":4},{"id":"f0375734-c576-4bca-88b5-522ca3a91dd8","name":"Is New Lead?","type":"n8n-nodes-base.if","position":[-9552,-752],"parameters":{"conditions":{"string":[{"value1":"={{ $json.is_new }}","value2":"Yes"}]}},"typeVersion":1},{"id":"a44a4532-578e-4e04-bf7f-c6665de00fb3","name":"Log Interaction","type":"n8n-nodes-base.googleSheets","position":[-9312,-752],"parameters":{"columns":{"value":{"Email":"={{ $('Save/Update Lead').item.json.email }}","Score":"={{ $('Save/Update Lead').item.json.score }}","Stage":"={{ $('Save/Update Lead').item.json.stage }}","Intent":"={{ $('Save/Update Lead').item.json.intent }}","Channel":"={{ $('Save/Update Lead').item.json.source_channel }}","Lead ID":"={{ $('Save/Update Lead').item.json.lead_id }}","Subject":"={{ $('Save/Update Lead').item.json.last_subject }}","Timestamp":"={{ new Date().toISOString() }}","Response Type":"={{ $('Save/Update Lead').item.json.response_type }}"},"mappingMode":"defineBelow"},"options":{},"operation":"append","sheetName":{"__rl":true,"mode":"list","value":"Interactions"},"documentId":{"__rl":true,"mode":"id","value":"YOUR_DOCUMENT_ID"}},"typeVersion":4},{"id":"6d1a471b-04b6-4776-97be-5f01e70a2a5f","name":"Notify Sales?","type":"n8n-nodes-base.if","position":[-9072,-752],"parameters":{"conditions":{"number":[{"value1":"={{ $('Calculate Lead Score').item.json.score }}","value2":70,"operation":"largerEqual"}]}},"typeVersion":1},{"id":"c3d19891-be49-46ad-8348-29b6f6b56cc9","name":"Slack - Hot Lead Alert","type":"n8n-nodes-base.slack","position":[-8832,-864],"webhookId":"3b8494e6-dfcd-4335-9fc0-69ac87ec3747","parameters":{"text":"Hot Lead Detected","otherOptions":{"includeLinkToWorkflow":false}},"typeVersion":2},{"id":"00316e5d-7915-47d8-a2c9-3335a4190e4b","name":"Leads for Nurturing","type":"n8n-nodes-base.googleSheets","position":[-12368,416],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":"Leads"},"documentId":{"__rl":true,"mode":"id","value":"YOUR_DOCUMENT_ID"}},"typeVersion":4},{"id":"4108d285-8835-4d66-bd9e-92720b28bf52","name":"Filter for Nurturing","type":"n8n-nodes-base.code","position":[-12128,416],"parameters":{"jsCode":"const leads = $input.all().map(i => i.json);\nconst now = new Date();\n\nconst nurturingLeads = leads.filter(lead => {\n  const score = parseInt(lead.score || '0');\n  const stage = lead.stage || '';\n  const lastInteraction = lead.last_interaction ? new Date(lead.last_interaction) : null;\n  \n  let daysSinceContact = 999;\n  if (lastInteraction) {\n    daysSinceContact = Math.floor((now - lastInteraction) / (1000 * 60 * 60 * 24));\n  }\n  \n  return (\n    score >= 20 && \n    score <= 60 && \n    stage !== 'disqualified' &&\n    stage !== 'won' &&\n    stage !== 'lost' &&\n    daysSinceContact >= 3\n  );\n}).slice(0, 10);\n\nreturn nurturingLeads.map(l => ({ json: l }));"},"typeVersion":2},{"id":"f77c6397-c770-4b11-b090-3a2402d7da9f","name":"AI Nurturing Email","type":"@n8n/n8n-nodes-langchain.openAi","position":[-11888,416],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"maxTokens":300,"temperature":0.8},"messages":{"values":[{"role":"system","content":"Generate a short personalized follow-up (nurturing) email.\n\nGOAL: Keep the lead engaged without being pushy.\n\nCONTENT OPTIONS (choose one):\n1. Share a useful tip related to their interests\n2. Mention a new update or feature\n3. Offer a free resource\n4. Ask if they have questions\n\nMaximum 2 paragraphs, friendly tone. Plain text only."},{"content":"=Lead: {{ $json.name }}\nInterests: {{ $json.interests || 'general' }}\nPain Points: {{ $json.pain_points || 'not identified' }}\nLast subject: {{ $json.last_subject }}\n\nGenerate nurturing email."}]}},"typeVersion":1},{"id":"91d07eb2-d2d2-4c1a-9eb7-8a571792b99e","name":"Read Report Data","type":"n8n-nodes-base.googleSheets","position":[-12368,848],"parameters":{"options":{},"sheetName":{"__rl":true,"mode":"list","value":"Leads"},"documentId":{"__rl":true,"mode":"id","value":"YOUR_DOCUMENT_ID"}},"typeVersion":4},{"id":"d5df1ae4-b796-4a5e-86d7-250a5dc1905a","name":"Calculate Metrics","type":"n8n-nodes-base.code","position":[-12128,848],"parameters":{"jsCode":"const leads = $input.all().map(i => i.json);\nconst now = new Date();\nconst sevenDaysAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);\n\nconst totalLeads = leads.length;\n\nconst byStage = {};\nleads.forEach(l => {\n  const stage = l.stage || 'no_stage';\n  byStage[stage] = (byStage[stage] || 0) + 1;\n});\n\nconst newThisWeek = leads.filter(l => {\n  const date = new Date(l.last_interaction || 0);\n  return date >= sevenDaysAgo && l.is_new === 'Yes';\n}).length;\n\nconst avgScore = leads.length > 0 \n  ? Math.round(leads.reduce((sum, l) => sum + parseInt(l.score || 0), 0) / leads.length)\n  : 0;\n\nconst hotLeads = leads.filter(l => parseInt(l.score || 0) >= 70).length;\n\nconst byChannel = {};\nleads.forEach(l => {\n  const channel = l.source_channel || 'unknown';\n  byChannel[channel] = (byChannel[channel] || 0) + 1;\n});\n\nconst byIntent = {};\nleads.forEach(l => {\n  const intent = l.intent || 'other';\n  byIntent[intent] = (byIntent[intent] || 0) + 1;\n});\n\nreturn {\n  json: {\n    period: `${sevenDaysAgo.toLocaleDateString('en-US')} - ${now.toLocaleDateString('en-US')}`,\n    totalLeads,\n    newThisWeek,\n    hotLeads,\n    avgScore,\n    byStageJSON: JSON.stringify(byStage),\n    byChannelJSON: JSON.stringify(byChannel),\n    byIntentJSON: JSON.stringify(byIntent),\n    stages: byStage,\n    channels: byChannel,\n    intents: byIntent\n  }\n};"},"typeVersion":2},{"id":"601108fe-fb15-4f10-a50f-36c6b317554c","name":"Slack - Weekly Report","type":"n8n-nodes-base.slack","position":[-11888,848],"webhookId":"aef0f129-bb7f-4f54-bd8d-933114a0a2ae","parameters":{"text":"Weekly Lead Report","otherOptions":{"includeLinkToWorkflow":false}},"typeVersion":2},{"id":"af1a3fc4-427f-4f6b-838f-75ab019026d5","name":"Error Trigger","type":"n8n-nodes-base.errorTrigger","position":[-12656,1248],"parameters":{},"typeVersion":1},{"id":"8a503126-2c79-4ae3-afc8-6e8189b7ff0d","name":"Slack - Error Alert","type":"n8n-nodes-base.slack","position":[-12352,1248],"webhookId":"892fb06a-316e-4bd1-ada5-f01ed3a532cf","parameters":{"text":"Error in AI Sales Agent","otherOptions":{"includeLinkToWorkflow":true}},"typeVersion":2},{"id":"927b9be3-8c34-4d34-8b4f-af62f0077d46","name":"Disqualify Lead","type":"n8n-nodes-base.code","position":[-10672,-208],"parameters":{"jsCode":"const lead = $('Calculate Lead Score').first().json;\n\nreturn {\n  json: {\n    ...lead,\n    stage: 'disqualified',\n    responseType: 'disqualified',\n    to: lead.email,\n    subject: '',\n    htmlContent: '',\n    aiResponse: 'Lead automatically disqualified'\n  }\n};"},"typeVersion":2},{"id":"7ec4f334-d220-4cb7-a5dc-100d98f5aa0f","name":"Create Call Task","type":"n8n-nodes-base.code","position":[-10672,-16],"parameters":{"jsCode":"const lead = $('Calculate Lead Score').first().json;\n\nreturn {\n  json: {\n    ...lead,\n    responseType: 'call_task',\n    task: {\n      type: 'call',\n      priority: lead.priority,\n      lead: lead.name,\n      email: lead.email,\n      phone: lead.phone,\n      reason: lead.aiSummary,\n      created: new Date().toISOString()\n    }\n  }\n};"},"typeVersion":2},{"id":"510345d6-5680-4261-9420-28f0017dcfe5","name":"Slack - Call Task","type":"n8n-nodes-base.slack","position":[-10432,-16],"webhookId":"21ec999f-51a5-4bfe-897b-37dcf4063fba","parameters":{"text":"New Task: Call Lead","otherOptions":{"includeLinkToWorkflow":false}},"typeVersion":2},{"id":"a43f2662-367b-483c-ba3b-90e7dab1b05c","name":"Ignore","type":"n8n-nodes-base.noOp","position":[-11888,-480],"parameters":{},"typeVersion":1},{"id":"074c2af0-d801-4086-ab94-29d3ef27c4dd","name":"Done","type":"n8n-nodes-base.noOp","position":[-8592,-752],"parameters":{},"typeVersion":1},{"id":"013c8183-9c06-41b5-9136-085bc0bb63bf","name":"Overview","type":"n8n-nodes-base.stickyNote","position":[-13248,-992],"parameters":{"color":2,"width":496,"height":1080,"content":"## Capture and score leads with GPT-4, Gmail and Google Sheets\n\nThis workflow transforms your Gmail inbox into an intelligent lead qualification system. When a new email arrives, GPT-4 analyzes the message to extract intent, urgency, and buying signals, then calculates a score from 0-100.\n\nBased on the score, leads are automatically routed to the right response: hot leads get a demo invitation, warm leads receive helpful information, and others enter a nurturing sequence. Every interaction is logged to Google Sheets as a lightweight CRM.\n\n### How it works\n\nThe workflow captures leads from Gmail, web forms, or chat webhooks. It filters out notifications and system emails, then uses GPT-4 to analyze sentiment, intent, and budget signals. A scoring algorithm combines AI insights with interaction history to calculate lead temperature. Finally, it generates personalized responses and alerts your sales team on Slack when hot leads arrive.\n\n### Setup steps\n\n1. Connect your Gmail, Google Sheets, Slack, and OpenAI credentials\n2. Create a Google Sheet with three tabs: Leads, Interactions, and Tasks\n3. Replace YOUR_DOCUMENT_ID with your Sheet ID in all Google Sheets nodes\n4. Configure your Slack channel for alerts\n5. Customize the email templates with your company info and Calendly link\n6. Test by sending yourself a sample inquiry email"},"typeVersion":1},{"id":"8bb61eff-9c50-453c-853b-6e0aec99e253","name":"Step 1 Lead Capture","type":"n8n-nodes-base.stickyNote","position":[-12688,-1008],"parameters":{"color":5,"width":480,"height":1112,"content":"## Lead Capture\n\nMulti-channel entry points: Gmail inbox polling, web form webhooks, and chat integrations. All sources are normalized into a unified lead format for consistent processing."},"typeVersion":1},{"id":"74f8ae10-e7f2-4e1a-9531-a739a4e5d959","name":"Step 2 Validation","type":"n8n-nodes-base.stickyNote","position":[-12144,-1008],"parameters":{"color":7,"width":640,"height":1112,"content":"## Validation\n\nFilters out system notifications (noreply, mailer-daemon), checks if lead already exists in your database, and retrieves interaction history for returning contacts."},"typeVersion":1},{"id":"194d3889-9294-431f-9f03-f566cc571466","name":"Step 3 AI Analysis","type":"n8n-nodes-base.stickyNote","position":[-11456,-1008],"parameters":{"color":6,"width":672,"height":1112,"content":"## AI Analysis & Scoring\n\nGPT-4 extracts sentiment, urgency, intent, and budget signals. The scoring engine combines AI insights with channel value and interaction history to calculate a 0-100 score, then routes to the appropriate response path."},"typeVersion":1},{"id":"0e764902-30cd-4c49-9a85-a3c73cd96cc0","name":"Step 4 Response","type":"n8n-nodes-base.stickyNote","position":[-10720,-1008],"parameters":{"color":5,"width":496,"height":1112,"content":"## Response Generation\n\nAI generates personalized responses based on lead temperature: demo invitations for hot leads, informative content for warm leads, and gentle nurturing for others. Call tasks are created for high-priority phone outreach."},"typeVersion":1},{"id":"ff8cb7c0-524e-423f-a530-faf5c6d9e0bc","name":"Step 5 CRM","type":"n8n-nodes-base.stickyNote","position":[-10080,-992],"parameters":{"color":7,"width":1696,"height":1096,"content":"## CRM & Notifications\n\nEmails are sent via Gmail, lead data is saved or updated in Google Sheets, and interactions are logged for history tracking. Hot leads (score 70+) trigger instant Slack alerts to your sales team."},"typeVersion":1},{"id":"ffa2c510-2981-4b66-9c6c-81cb335bbe2e","name":"Step 6 Nurturing","type":"n8n-nodes-base.stickyNote","position":[-12704,224],"parameters":{"color":6,"width":1136,"height":392,"content":"## Auto Nurturing\n\nRuns daily at 10 AM. Identifies warm leads (score 20-60) that haven't been contacted in 3+ days and sends AI-generated follow-up emails to keep them engaged without being pushy."},"typeVersion":1},{"id":"193febc2-d220-4d8a-89af-e51158f2f022","name":"Step 7 Reports","type":"n8n-nodes-base.stickyNote","position":[-12704,640],"parameters":{"color":5,"width":1136,"height":392,"content":"## Weekly Reports\n\nEvery Monday at 9 AM, calculates pipeline metrics: total leads, new this week, average score, conversion by stage, and channel performance. Summary is posted to Slack for team visibility."},"typeVersion":1},{"id":"0a215bc2-8456-4f20-a808-69ccb7fbbb6b","name":"Error Handling","type":"n8n-nodes-base.stickyNote","position":[-12704,1056],"parameters":{"color":7,"width":1152,"height":360,"content":"## Error Handling\n\nCatches any workflow errors and posts detailed alerts to a dedicated Slack channel, including a link to the failed execution for quick debugging."},"typeVersion":1}],"pinData":{},"connections":{"Send Email":{"main":[[{"node":"Save/Update Lead","type":"main","index":0}],[{"node":"Save/Update Lead","type":"main","index":0}]]},"Is New Lead?":{"main":[[{"node":"Sheet - New Lead","type":"main","index":0}],[{"node":"Sheet - Update Lead","type":"main","index":0}]]},"Action Router":{"main":[[{"node":"Generate Response - Demo","type":"main","index":0}],[{"node":"Generate Response - Info","type":"main","index":0}],[{"node":"Create Call Task","type":"main","index":0}],[{"node":"Generate Response - Nurturing","type":"main","index":0}],[{"node":"Disqualify Lead","type":"main","index":0}]]},"Check History":{"main":[[{"node":"AI Analysis Engine","type":"main","index":0}]]},"Error Trigger":{"main":[[{"node":"Slack - Error Alert","type":"main","index":0}]]},"Gmail Trigger":{"main":[[{"node":"Normalize Input","type":"main","index":0}]]},"Notify Sales?":{"main":[[{"node":"Slack - Hot Lead Alert","type":"main","index":0}],[{"node":"Done","type":"main","index":0}]]},"Is Valid Lead?":{"main":[[{"node":"Ignore","type":"main","index":0}],[{"node":"Find Existing Lead","type":"main","index":0}]]},"Disqualify Lead":{"main":[[{"node":"Save/Update Lead","type":"main","index":0}]]},"Log Interaction":{"main":[[{"node":"Notify Sales?","type":"main","index":0}]]},"Normalize Input":{"main":[[{"node":"Is Valid Lead?","type":"main","index":0}]]},"Create Call Task":{"main":[[{"node":"Slack - Call Task","type":"main","index":0}]]},"Read Report Data":{"main":[[{"node":"Calculate Metrics","type":"main","index":0}]]},"Save/Update Lead":{"main":[[{"node":"Is New Lead?","type":"main","index":0}]]},"Sheet - New Lead":{"main":[[{"node":"Log Interaction","type":"main","index":0}]]},"Calculate Metrics":{"main":[[{"node":"Slack - Weekly Report","type":"main","index":0}]]},"Slack - Call Task":{"main":[[{"node":"Save/Update Lead","type":"main","index":0}]]},"AI Analysis Engine":{"main":[[{"node":"Calculate Lead Score","type":"main","index":0}]]},"Find Existing Lead":{"main":[[{"node":"Check History","type":"main","index":0}]]},"Webhook - Web Form":{"main":[[{"node":"Normalize Input","type":"main","index":0}]]},"Leads for Nurturing":{"main":[[{"node":"Filter for Nurturing","type":"main","index":0}]]},"Sheet - Update Lead":{"main":[[{"node":"Log Interaction","type":"main","index":0}]]},"Calculate Lead Score":{"main":[[{"node":"Action Router","type":"main","index":0}]]},"Filter for Nurturing":{"main":[[{"node":"AI Nurturing Email","type":"main","index":0}]]},"Prepare Email - Demo":{"main":[[{"node":"Send Email","type":"main","index":0}]]},"Prepare Email - Info":{"main":[[{"node":"Send Email","type":"main","index":0}]]},"Weekly Report Trigger":{"main":[[{"node":"Read Report Data","type":"main","index":0}]]},"Auto Nurturing Trigger":{"main":[[{"node":"Leads for Nurturing","type":"main","index":0}]]},"Slack - Hot Lead Alert":{"main":[[{"node":"Done","type":"main","index":0}]]},"Generate Response - Demo":{"main":[[{"node":"Prepare Email - Demo","type":"main","index":0}]]},"Generate Response - Info":{"main":[[{"node":"Prepare Email - Info","type":"main","index":0}]]},"Prepare Email - Nurturing":{"main":[[{"node":"Send Email","type":"main","index":0}]]},"Webhook - WhatsApp/Telegram":{"main":[[{"node":"Normalize Input","type":"main","index":0}]]},"Generate Response - Nurturing":{"main":[[{"node":"Prepare Email - Nurturing","type":"main","index":0}]]}}}