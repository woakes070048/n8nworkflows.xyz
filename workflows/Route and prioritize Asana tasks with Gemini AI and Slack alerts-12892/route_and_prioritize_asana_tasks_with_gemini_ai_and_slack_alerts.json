{"name":"Route and prioritize Asana tasks using AI agent","nodes":[{"id":"sticky-main","name":"Sticky Note Main","type":"n8n-nodes-base.stickyNote","position":[-480,240],"parameters":{"color":3,"width":500,"height":420,"content":"# Asana Triage Agent\n\n## How it works\n1. **Trigger:** Detects new tasks in your specific Asana project (e.g., \"Inbox\").\n2. **Analyze:** **Gemini** analyzes the task title and description to determine **Category** (Bug/Feature/Inquiry) and **Priority**.\n3. **Route:** Automatically maps the category to the correct team member's email defined in Config.\n4. **Update:** Updates the task in Asana with the new Assignee and adds an AI summary.\n5. **Alert:** If priority is **High**, sends an urgent notification to **Slack**.\n\n## Setup steps\n1. **Credentials:** Connect Asana, Gemini, and Slack.\n2. **Config:** Open **\"1. Configuration\"** to set your Project ID and Team Emails.\n3. **Prerequisite:** Ensure the emails used match actual users in your Asana workspace."},"typeVersion":1},{"id":"sticky-config","name":"Sticky Note Config","type":"n8n-nodes-base.stickyNote","position":[20,240],"parameters":{"color":7,"width":380,"height":280,"content":"## 1. Config\nDefine your Routing Rules (Who handles what) and Project ID."},"typeVersion":1},{"id":"sticky-ai","name":"Sticky Note AI","type":"n8n-nodes-base.stickyNote","position":[420,240],"parameters":{"color":7,"width":460,"height":460,"content":"## 2. AI Analysis\nGemini acts as a PM, categorizing the task based on context."},"typeVersion":1},{"id":"sticky-route","name":"Sticky Note Route","type":"n8n-nodes-base.stickyNote","position":[900,240],"parameters":{"color":7,"width":460,"height":460,"content":"## 3. Route & Update\nMaps category to email and updates the task."},"typeVersion":1},{"id":"sticky-alert","name":"Sticky Note Alert","type":"n8n-nodes-base.stickyNote","position":[1380,240],"parameters":{"color":7,"width":460,"height":460,"content":"## 4. Emergency Alert\nNotifies Slack only if the task is urgent."},"typeVersion":1},{"id":"config","name":"Configuration","type":"n8n-nodes-base.set","position":[80,340],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"projectId","type":"string","value":""},{"id":"id-2","name":"email_bug","type":"string","value":"user@example.com"},{"id":"id-3","name":"email_feature","type":"string","value":"user@example.com"},{"id":"id-4","name":"email_support","type":"string","value":"support@example.com"},{"id":"id-5","name":"slackChannel","type":"string","value":"alerts"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"asana-trigger","name":"Asana Trigger","type":"n8n-nodes-base.asanaTrigger","position":[260,340],"webhookId":"asana-triage-webhook","parameters":{"events":["added"],"project":"={{ $('Configuration').first().json.projectId }}","resource":"task"},"credentials":{"asanaApi":{"id":"credential-id","name":"Asana account"}},"typeVersion":1},{"id":"gemini-analyze","name":"Gemini: Analyze","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[480,340],"parameters":{"modelId":{"__rl":true,"mode":"list","value":"models/gemini-1.5-flash","cachedResultName":"models/gemini-1.5-flash"},"options":{},"messages":{"values":[{"content":"=You are a Project Manager.\nAnalyze this task and categorize it.\n\n[Task]\nTitle: {{ $json.name }}\nNotes: {{ $json.notes }}\n\n[Categories]\n- Bug (Technical issues)\n- Feature (New requests)\n- Support (User questions)\n\n[Output]\nJSON ONLY:\n{\n  \"category\": \"Bug\" or \"Feature\" or \"Support\",\n  \"priority\": \"High\" or \"Normal\",\n  \"summary\": \"One sentence summary\"\n}"}]}},"credentials":{"googlePalmApi":{"id":"credential-id","name":"Google Gemini(PaLM) Api account"}},"typeVersion":1},{"id":"map-data","name":"Map Data","type":"n8n-nodes-base.code","position":[700,340],"parameters":{"jsCode":"// Parse JSON & Map to Email\nconst text = $input.first().json.content.parts[0].text;\nconst config = $('Configuration').first().json;\nlet data = {};\n\n// 1. Safe Parse\ntry {\n  const cleanText = text.replace(/```json/g, '').replace(/```/g, '').trim();\n  data = JSON.parse(cleanText);\n} catch (e) {\n  data = { category: \"Support\", priority: \"Normal\", summary: text };\n}\n\n// 2. Map Category to Email\nlet assignee = config.email_support; // Default\nif (data.category === 'Bug') assignee = config.email_bug;\nif (data.category === 'Feature') assignee = config.email_feature;\n\ndata.assignee_email = assignee;\ndata.taskGid = $('Asana Trigger').first().json.gid;\n\nreturn { json: data };"},"typeVersion":2},{"id":"update-task","name":"Update Task","type":"n8n-nodes-base.asana","position":[940,340],"parameters":{"id":"={{ $json.taskGid }}","name":"={{ $json.priority === 'High' ? 'ðŸ”´ ' : '' }}{{ $('Asana Trigger').first().json.name }}","notes":"=ðŸ¤– **AI Summary:** {{ $json.summary }}\n**Category:** {{ $json.category }}\n\n---\n{{ $('Asana Trigger').first().json.notes }}","assignee":"={{ $json.assignee_email }}","resource":"task","operation":"update","otherOptions":{}},"credentials":{"asanaApi":{"id":"credential-id","name":"Asana account"}},"typeVersion":1},{"id":"check-priority","name":"Is High Priority?","type":"n8n-nodes-base.if","position":[1160,340],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"is_high","operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.priority }}","rightValue":"High"}]}},"typeVersion":2.2},{"id":"notify-slack","name":"Notify Slack","type":"n8n-nodes-base.slackweb","position":[1400,220],"parameters":{"text":"=ðŸš¨ **Urgent Task Assigned**\n\n**Task:** {{ $('Asana Trigger').first().json.name }}\n**Assigned To:** {{ $json.assignee_email }}\n**Summary:** {{ $json.summary }}\n\nðŸ‘‰ Check Asana for details.","channelId":"={{ $('Configuration').first().json.slackChannel }}","otherOptions":{},"authentication":"webhook"},"credentials":{"slackIncomingWebhookApi":{"id":"credential-id","name":"Slack Webhook"}},"typeVersion":1.1}],"pinData":{},"connections":{"Map Data":{"main":[[{"node":"Update Task","type":"main","index":0}]]},"Update Task":{"main":[[{"node":"Is High Priority?","type":"main","index":0}]]},"Asana Trigger":{"main":[[{"node":"Gemini: Analyze","type":"main","index":0}]]},"Configuration":{"main":[[{"node":"Asana Trigger","type":"main","index":0}]]},"Gemini: Analyze":{"main":[[{"node":"Map Data","type":"main","index":0}]]},"Is High Priority?":{"main":[[{"node":"Notify Slack","type":"main","index":0}]]}}}